<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–µ–Ω–∞Pro - –†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç–µ–Ω</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞ */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #4A5259 0%, #3a3f44 100%);
        }

        .login-box {
            background: white;
            padding: 40px 50px;
            border-radius: 12px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            width: 800px;
            max-width: 90%;
            display: flex;
            gap: 40px;
            animation: slideUp 0.5s ease-out;
        }

        .login-info {
            flex: 1;
        }
        
        .login-info h2 {
            font-size: 28px;
            color: #D67A34;
            margin-bottom: 15px;
        }
        
        .login-info p {
            font-size: 14px;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .features-list {
            list-style: none;
            padding: 0;
        }
        
        .features-list li {
            font-size: 13px;
            color: #444;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }
        
        .features-list li::before {
            content: '‚úì';
            color: #4CAF50;
            font-weight: bold;
            margin-right: 10px;
            font-size: 16px;
        }
        
        .login-form-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-form-container .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .login-form-container .logo {
            height: 60px;
            background: #f0f0f0;
            padding: 8px;
            border-radius: 10px;
        }

        .login-error {
            color: #f44336;
            font-size: 13px;
            text-align: center;
            height: 20px;
            margin-bottom: 10px;
        }

        .app {
            display: none; /* –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ */
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #D67A34 0%, #4A5259 100%);
            color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            height: 50px;
            width: auto;
            background: white;
            padding: 5px;
            border-radius: 8px;
        }

        .header h1 {
            font-size: 24px;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .admin-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .project-info {
            font-size: 14px;
            opacity: 0.95;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .toolbar {
            width: 320px;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }

        .toolbar-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .room-selector {
            padding: 15px 20px;
            background: #fff3cd;
            border-bottom: 2px solid #ffc107;
        }

        .room-selector select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .wall-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .wall-tab {
            padding: 6px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .wall-tab:hover {
            background: #e3f2fd;
        }

        .wall-tab.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .tools-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .tool-category {
            margin-bottom: 15px;
        }

        .category-btn {
            width: 100%;
            padding: 12px 15px;
            background: linear-gradient(135deg, #D67A34 0%, #4A5259 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            transition: transform 0.2s;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-btn:hover {
            transform: translateY(-2px);
        }

        .category-btn.active {
            background: linear-gradient(135deg, #4A5259 0%, #D67A34 100%);
        }

        .category-btn::after {
            content: '‚ñº';
            font-size: 10px;
            transition: transform 0.3s;
        }

        .category-btn.active::after {
            transform: rotate(180deg);
        }

        .tool-list {
            display: none;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .tool-list.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tool-item {
            padding: 10px 12px;
            margin-bottom: 6px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .tool-item:hover {
            background: #e3f2fd;
            border-color: #2196F3;
            transform: translateX(5px);
        }

        .tool-item.selected {
            background: linear-gradient(135deg, #D67A34 0%, #4A5259 100%);
            color: white;
            border-color: #D67A34;
        }

        .tool-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f5f5f5;
        }

        .tool-item.disabled:hover {
            transform: none;
            border-color: #e0e0e0;
            background: #f5f5f5;
        }

        .tool-price {
            font-size: 11px;
            font-weight: 600;
            opacity: 0.9;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            background: #fafafa;
            overflow: hidden;
        }

        .canvas-wrapper {
            width: 100%;
            height: 100%;
            overflow: auto;
            position: relative;
        }

        #canvas {
            background: white;
            display: block;
            cursor: default;
        }

        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }

        .zoom-btn {
            width: 45px;
            height: 45px;
            background: white;
            border: 2px solid #D67A34;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            color: #D67A34;
            transition: all 0.2s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .zoom-btn:hover {
            background: #D67A34;
            color: white;
            transform: scale(1.1);
        }

        .zoom-level {
            text-align: center;
            background: white;
            padding: 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: #D67A34;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .measurement-tooltip {
            position: absolute;
            background: rgba(214, 122, 52, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            pointer-events: none;
            display: none;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            white-space: nowrap;
        }

        .measurement-tooltip::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(214, 122, 52, 0.95);
        }

        .info-panel {
            width: 320px;
            background: white;
            border-left: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }

        .info-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-header h3 {
            font-size: 16px;
            color: #333;
        }

        .element-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .element-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #f9f9f9;
            border-left: 4px solid #D67A34;
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.2s;
        }

        .element-item:hover {
            background: #fff3e0;
            transform: translateX(3px);
        }

        .element-item.selected {
            background: #fff3e0;
            border-left-color: #4A5259;
            border-left-width: 6px;
            box-shadow: 0 2px 8px rgba(214, 122, 52, 0.2);
        }

        .element-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .element-name {
            font-weight: 600;
            color: #333;
        }

        .element-details {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .element-cost {
            font-weight: 600;
            color: #4CAF50;
        }

        #infoContent {
            padding: 15px;
            border-top: 1px solid #ddd;
            flex-shrink: 0;
            max-height: 350px;
            overflow-y: auto;
        }

        .total-cost {
            padding: 20px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-top: 3px solid #4CAF50;
        }

        .total-cost h4 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }

        .cost-total {
            font-size: 20px;
            font-weight: bold;
            color: #1b5e20;
            border-top: 2px solid #4CAF50;
            padding-top: 12px;
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
        }

        .profile-summary {
            background: #fff9c4;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            border-left: 4px solid #fbc02d;
        }

        .profile-summary h5 {
            margin-bottom: 10px;
            color: #f57f17;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 5px;
            color: #555;
        }

        .controls {
            padding: 15px 20px;
            background: white;
            border-top: 2px solid #e0e0e0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            flex: 1;
            min-width: 120px;
        }

        .control-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .control-btn.secondary {
            background: #2196F3;
        }

        .control-btn.secondary:hover {
            background: #1976D2;
        }

        .control-btn.danger {
            background: #f44336;
        }

        .control-btn.danger:hover {
            background: #d32f2f;
        }

        .control-btn.warning {
            background: #ff9800;
        }

        .control-btn.warning:hover {
            background: #f57c00;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 600px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        .modal-content.large {
            width: 90%;
            max-width: 1200px;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 24px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: #333;
        }

        /* –†–µ–¥–∞–∫—Ç–æ—Ä —Å–º–µ—Ç—ã */
        .estimate-editor {
            margin-top: 20px;
        }

        .estimate-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .estimate-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
        }

        .estimate-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .estimate-table tr:hover {
            background: #f5f5f5;
        }

        .estimate-table input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        .add-row-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .add-row-btn:hover {
            background: #45a049;
        }

        .wizard-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .wizard-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .wizard-step::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #ddd;
            z-index: -1;
        }

        .wizard-step:last-child::after {
            display: none;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            background: #ddd;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .wizard-step.active .step-circle {
            background: #667eea;
        }

        .wizard-step.completed .step-circle {
            background: #4CAF50;
        }

        .step-label {
            font-size: 11px;
            color: #666;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #D67A34;
        }

        .object-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .object-type-card {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .object-type-card:hover {
            border-color: #D67A34;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(214, 122, 52, 0.2);
        }

        .object-type-card.selected {
            border-color: #D67A34;
            background: linear-gradient(135deg, rgba(214, 122, 52, 0.1) 0%, rgba(74, 82, 89, 0.1) 100%);
        }

        .type-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .type-name {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }

        .counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .counter-btn {
            width: 40px;
            height: 40px;
            background: #D67A34;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .counter-btn:hover {
            background: #4A5259;
            transform: scale(1.1);
        }

        .counter-value {
            font-size: 32px;
            font-weight: bold;
            color: #D67A34;
            min-width: 60px;
            text-align: center;
        }

        .room-config {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .room-config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #D67A34 0%, #4A5259 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(214, 122, 52, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            padding: 12px 30px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .admin-panel {
            max-width: 800px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .admin-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.2s;
        }

        .admin-tab:hover {
            color: #D67A34;
        }

        .admin-tab.active {
            color: #D67A34;
            border-bottom-color: #D67A34;
        }

        .tools-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 13px;
        }

        .tools-table th {
            background: #f8f9fa;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }

        .tools-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f0f0f0;
        }

        .tools-table input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        .btn-small {
            padding: 5px 12px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #2196F3;
            color: white;
            margin-right: 5px;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-save {
            background: #4CAF50;
            color: white;
        }

        .btn-small:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .add-tool-form {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .no-project {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .no-project-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .no-project h3 {
            margin-bottom: 10px;
            color: #666;
        }

        .dragging {
            opacity: 0.6;
            cursor: move !important;
        }

        .file-input-label {
            display: inline-block;
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }

        .file-input-label:hover {
            background: #1976D2;
        }

        #fileInput {
            display: none;
        }

        /* –î–û–ë–ê–í–õ–ï–ù–û: –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ */
        .project-manager {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .project-item:hover {
            background: #f0f0f0;
        }

        .project-info-item {
            flex: 1;
        }

        .project-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .project-details {
            font-size: 12px;
            color: #666;
        }

        .project-actions {
            display: flex;
            gap: 10px;
        }

        .btn-load {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .btn-load:hover {
            background: #45a049;
        }

        /* –î–û–ë–ê–í–õ–ï–ù–û: –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 5px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            display: none;
            min-width: 180px;
        }

        .context-menu.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .context-menu-item {
            padding: 10px 20px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .context-menu-item:hover {
            background: #f0f0f0;
        }

        .context-menu-item.danger {
            color: #f44336;
        }

        .context-menu-divider {
            border-top: 1px solid #e0e0e0;
            margin: 5px 0;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-info">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h2>
                <p>–í–∞—à –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–Ω–∏—à–Ω–æ–π –æ—Ç–¥–µ–ª–∫–∏ —Å—Ç–µ–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Ç–µ–∫—Å—Ç–∏–ª–µ–º –ø–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ "–¢–∏—Ö–∏–µ –°—Ç–µ–Ω—ã". –£–ø—Ä–æ—Å—Ç–∏—Ç–µ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –∏ –ø–æ–≤—ã—Å—å—Ç–µ —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤.</p>
                
                <h4>–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</h4>
                <ul class="features-list">
                    <li>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π 2D-—Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–µ–Ω</li>
                    <li>–ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
                    <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å–º–µ—Ç—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Ä–∞–±–æ—Ç</li>
                    <li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ</li>
                    <li>–≠–∫—Å–ø–æ—Ä—Ç —Å–º–µ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç Excel</li>
                    <li>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º —É—Å–ª—É–≥</li>
                </ul>
            </div>
            <div class="login-form-container">
                <div class="logo-container">
                    <img src="gemini-2.5-flash-image-preview (nano-banana)_a_–∏–∑–º–µ–Ω–∏_—Ä–∞–∑–º–µ—Ä_–º–æ–π_–∫–∞.png" alt="–°—Ç–µ–Ω–∞Pro" class="logo">
                </div>
                <div class="form-group">
                    <label for="loginUsername">–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ª–æ–≥–∏–Ω">
                </div>
                <div class="form-group">
                    <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                </div>
                <div id="loginError" class="login-error"></div>
                <button class="btn-primary" style="width: 100%;" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="app">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="header-left">
                <img src="gemini-2.5-flash-image-preview (nano-banana)_a_–∏–∑–º–µ–Ω–∏_—Ä–∞–∑–º–µ—Ä_–º–æ–π_–∫–∞.png"
                     alt="–°—Ç–µ–Ω–∞Pro" class="logo" id="companyLogo">
                <img src="443114.png"
                     alt="–°—Ç–µ–Ω–∞Pro" class="logo" id="companyLogo2">
            </div>
            <div class="header-right">
                <div class="project-info" id="headerProjectInfo">
                    <div id="projectName">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</div>
                </div>
                <button class="admin-btn" onclick="showAdminPanel()">‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
            </div>
        </div>

        <div class="main-container">
            <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
            <div class="toolbar">
                <div class="toolbar-header">
                    <h3>üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
                </div>

                <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç –∏ —Å—Ç–µ–Ω -->
                <div class="room-selector" id="roomSelector" style="display: none;">
                    <select id="roomSelect" onchange="changeRoom()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É</option>
                    </select>
                    <div class="wall-tabs" id="wallTabs"></div>
                </div>

                <div class="tools-container" id="toolsContainer">
                    <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –•–æ–ª—Å—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è -->
            <div class="canvas-container" id="canvasContainer">
                <div id="noProject" class="no-project">
                    <div class="no-project-icon">üìê</div>
                    <h3>–ü—Ä–æ–µ–∫—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
                    <button class="btn-primary" style="margin-top: 20px;" onclick="showProjectWizard()">
                        –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                    </button>
                    <button class="btn-secondary" style="margin-top: 10px;" onclick="showProjectManager()">
                        üìÇ –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
                    </button>
                </div>
                <div class="canvas-wrapper" id="canvasWrapper" style="display: none;">
                    <canvas id="canvas"></canvas>
                </div>

                <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ -->
                <div class="measurement-tooltip" id="measurementTooltip"></div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–æ–º -->
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <div class="zoom-level" id="zoomLevel">100%</div>
                    <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
                    <button class="zoom-btn" onclick="resetZoom()" title="–°–±—Ä–æ—Å" style="font-size: 16px;">‚ü≤</button>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="info-panel">
                <div class="info-header">
                    <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                </div>

                <div class="element-list" id="elementList">
                    <div style="text-align: center; padding: 20px; color: #999;">
                        <p>–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                    </div>
                </div>

                <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–≤–æ–π—Å—Ç–≤ —ç–ª–µ–º–µ–Ω—Ç–∞ -->
                <div id="infoContent"></div>

                <div class="total-cost">
                    <h4>üí∞ –°–º–µ—Ç–∞</h4>

                    <!-- –°–≤–æ–¥–∫–∞ –ø–æ –ø—Ä–æ—Ñ–∏–ª—è–º -->
                    <div class="profile-summary" id="profileSummary" style="display: none;">
                        <h5>üìè –ü—Ä–æ—Ñ–∏–ª–∏ (–æ–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ 2-–º)</h5>
                        <div id="profileList"></div>
                    </div>

                    <div class="cost-item">
                        <span>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</span>
                        <span id="materialCost">0 ‚ÇΩ</span>
                    </div>
                    <div class="cost-item">
                        <span>–†–∞–±–æ—Ç–∞:</span>
                        <span id="workCost">0 ‚ÇΩ</span>
                    </div>
                    <div class="cost-total">
                        <span>–ò–¢–û–ì–û:</span>
                        <span id="totalCost">0 ‚ÇΩ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="controls">
            <button class="control-btn secondary" onclick="showProjectWizard()">
                ‚ûï –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
            </button>
            <button class="control-btn secondary" onclick="showProjectManager()">
                üìÇ –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
            </button>
            <button class="control-btn danger" onclick="clearCanvas()">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
            </button>
            <button class="control-btn warning" onclick="showEstimateEditor()">
                ‚úèÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–º–µ—Ç—É
            </button>
            <button class="control-btn" onclick="saveProject()">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
            </button>
            <button class="control-btn" onclick="downloadExcel()">
                üì• –°–∫–∞—á–∞—Ç—å Excel
            </button>
        </div>

        <!-- –î–û–ë–ê–í–õ–ï–ù–û: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é -->
        <div id="contextMenu" class="context-menu">
            <div class="context-menu-item" onclick="duplicateContextElement()">
                üìã –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
            </div>
            <div class="context-menu-item" onclick="showElementProperties()">
                ‚ÑπÔ∏è –°–≤–æ–π—Å—Ç–≤–∞
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div id="projectWizard" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h2>
                <button class="close-btn" onclick="closeProjectWizard()">√ó</button>
            </div>

            <div class="wizard-steps">
                <div class="wizard-step active" id="wizardStep1">
                    <div class="step-circle">1</div>
                    <div class="step-label">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
                </div>
                <div class="wizard-step" id="wizardStep2">
                    <div class="step-circle">2</div>
                    <div class="step-label">–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞</div>
                </div>
                <div class="wizard-step" id="wizardStep3">
                    <div class="step-circle">3</div>
                    <div class="step-label">–ö–æ–º–Ω–∞—Ç—ã</div>
                </div>
                <div class="wizard-step" id="wizardStep4">
                    <div class="step-circle">4</div>
                    <div class="step-label">–°—Ç–µ–Ω—ã</div>
                </div>
            </div>

            <div id="wizardContent"></div>

            <div class="btn-group">
                <button class="btn-secondary" id="prevBtn" onclick="prevWizardStep()" style="display: none;">
                    ‚Üê –ù–∞–∑–∞–¥
                </button>
                <button class="btn-primary" id="nextBtn" onclick="nextWizardStep()">
                    –î–∞–ª–µ–µ ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
    <div id="projectManagerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÇ –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤</h2>
                <button class="close-btn" onclick="closeProjectManager()">√ó</button>
            </div>

            <div id="projectManagerContent">
                <div class="project-manager" id="projectsList">
                    <!-- –ü—Ä–æ–µ–∫—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <div class="btn-group">
                <button class="btn-secondary" onclick="closeProjectManager()">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn-primary" onclick="showProjectWizard(); closeProjectManager();">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Å–º–µ—Ç—ã -->
    <div id="estimateModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä —Å–º–µ—Ç—ã</h2>
                <button class="close-btn" onclick="closeEstimateEditor()">√ó</button>
            </div>

            <div class="estimate-editor">
                <button class="add-row-btn" onclick="addManualRow()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>

                <div style="overflow-x: auto;">
                    <table class="estimate-table" id="estimateTable">
                        <thead>
                            <tr>
                                <th>‚Ññ</th>
                                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–ï–¥.</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</th>
                                <th>–†–∞–±–æ—Ç–∞</th>
                                <th>–ò—Ç–æ–≥–æ</th>
                            </tr>
                        </thead>
                        <tbody id="estimateTableBody"></tbody>
                        <tfoot>
                            <tr style="background: #e8f5e9; font-weight: bold;">
                                <td colspan="4">–ò–¢–û–ì–û:</td>
                                <td id="estimateTotalMaterial">0 ‚ÇΩ</td>
                                <td id="estimateTotalWork">0 ‚ÇΩ</td>
                                <td id="estimateGrandTotal">0 ‚ÇΩ</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="btn-group">
                    <button class="btn-secondary" onclick="closeEstimateEditor()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" onclick="saveEstimateChanges()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ -->
    <div id="adminModal" class="modal">
        <div class="modal-content admin-panel">
            <div class="modal-header">
                <h2>‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
                <button class="close-btn" onclick="closeAdminPanel()">√ó</button>
            </div>

            <div id="adminAuth" style="display: none;">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="adminLogin" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <button class="btn-primary" onclick="adminLogin()">–í–æ–π—Ç–∏</button>
            </div>

            <div id="adminContent" style="display: none;">
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="showAdminTab('tools')">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
                    <button class="admin-tab" onclick="showAdminTab('logo')">–õ–æ–≥–æ—Ç–∏–ø</button>
                </div>

                <div id="adminToolsTab">
                    <div class="add-tool-form">
                        <h4>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <select id="newToolCategory">
                                    <option value="–ü—Ä–æ—Ñ–∏–ª—å">–ü—Ä–æ—Ñ–∏–ª—å</option>
                                    <option value="–¢–∫–∞–Ω—å">–¢–∫–∞–Ω—å</option>
                                    <option value="–ú–µ–º–±—Ä–∞–Ω–∞">–ú–µ–º–±—Ä–∞–Ω–∞</option>
                                    <option value="–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫">–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫</option>
                                    <option value="–ó–∞–∫–ª–∞–¥–Ω–∞—è">–ó–∞–∫–ª–∞–¥–Ω–∞—è</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                                <input type="text" id="newToolName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                            </div>
                            <div class="form-group">
                                <label>–ï–¥–∏–Ω–∏—Ü–∞</label>
                                <input type="text" id="newToolUnit" placeholder="–º, –º¬≤, —à—Ç">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>–¶–µ–Ω–∞</label>
                                <input type="number" id="newToolPrice" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label>–¶–µ–Ω–∞ —Ä–∞–±–æ—Ç—ã</label>
                                <input type="number" id="newToolWorkPrice" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label>–í—ã—Å–æ—Ç–∞ (–º)</label>
                                <input type="number" step="0.01" id="newToolHeight" placeholder="2.9">
                            </div>
                        </div>
                        <button class="btn-primary" onclick="addNewTool()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</button>
                    </div>

                    <table class="tools-table" id="toolsTable">
                        <thead>
                            <tr>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ï–¥.</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–†–∞–±–æ—Ç–∞</th>
                                <th>–í—ã—Å–æ—Ç–∞(–º)</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="toolsTableBody"></tbody>
                    </table>
                </div>

                <div id="adminLogoTab" style="display: none;">
                    <div class="form-group">
                        <label>URL –ª–æ–≥–æ—Ç–∏–ø–∞</label>
                        <input type="text" id="logoUrl" placeholder="https://example.com/logo.png">
                    </div>
                    <button class="btn-primary" onclick="updateLogo()">–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø</button>
                    <div style="margin-top: 20px;">
                        <p><strong>–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø:</strong></p>
                        <img id="currentLogo" style="max-width: 200px; margin-top: 10px; border: 1px solid #ddd; padding: 5px;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // ============ –õ–û–ì–ò–ö–ê –í–•–û–î–ê ============
        function handleLogin() {
            const loginInput = document.getElementById('loginUsername').value;
            const passwordInput = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            if (loginInput === 'KamaPuly' && passwordInput === 'KamilaGodzila123456') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'flex';
            } else {
                errorDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
            }
        }

        // ============ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ============
        let canvas, ctx, canvasWrapper;
        let currentTool = null;
        let isDrawing = false;
        let startX, startY;
        let elements = [];
        let manualEstimateItems = [];
        let currentElement = null;
        let gridSize = 10;
        let pixelsPerCm = 10;
        let pixelsPerMeter = 100;
        let currentWizardStep = 1;
        let isAdminAuthenticated = false;
        let zoom = 1;
        let isDragging = false;
        let draggedElement = null;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let maxWallHeight = 0;
        let elementIdCounter = 1;

        // –î–û–ë–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        let contextElementId = null;
        let hoveredElement = null;
        let selectedElementId = null; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        let toolsDatabase = [
            { id: 1, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–ë–∞–∑–æ–≤—ã–π-–Ω–µ–∫—Ä–∞—à–µ–Ω—ã–π', unit: '–º', price: 450, workPrice: 0, height: 0 },
            { id: 2, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–ë–∞–∑–æ–≤—ã–π-—á–µ—Ä–Ω—ã–π', unit: '–º', price: 450, workPrice: 0, height: 0 },
            { id: 3, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–ü–ª–∏–Ω—Ç—É—Å –¢–µ–Ω–µ–≤–æ–π', unit: '–º', price: 750, workPrice: 0, height: 0 },
            { id: 4, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–û—Ç–±–æ–π–Ω–∏–∫', unit: '–º', price: 550, workPrice: 800, height: 0 },
            { id: 5, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —É–≥–æ–ª', unit: '–º', price: 650, workPrice: 800, height: 0 },
            { id: 6, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–û–∫–Ω–æ-–û—Ç–∫–æ—Å', unit: '–º', price: 800, workPrice: 2500, height: 0 },
            { id: 7, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–æ–Ω–Ω—ã–π', unit: '–º', price: 500, workPrice: 0, height: 0 },
            { id: 8, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å 2–º–º', unit: '–º', price: 800, workPrice: 1600, height: 0 },
            { id: 9, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–ö–ê–°–ö–ê–î-–ù–µ–∫—Ä–∞—à–µ–Ω—ã–π', unit: '–º', price: 800, workPrice: 0, height: 0 },
            { id: 10, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä-–ß–µ—Ä–Ω—ã–π', unit: '–º', price: 500, workPrice: 0, height: 0 },
            { id: 11, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–ü–ª–∏–Ω—Ç—É—Å –ö–æ–Ω—Ç—É—Ä –ü–ª—é—Å', unit: '–º', price: 900, workPrice: 0, height: 0 },
            { id: 12, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–°–≤–µ—Ç–æ–≤–∞—è –õ–∏–Ω–∏—è –±–µ–ª–∞—è', unit: '–º', price: 850, workPrice: 0, height: 0 },
            { id: 13, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–°–≤–µ—Ç–æ–≤–∞—è –õ–∏–Ω–∏—è —á–µ—Ä–Ω–∞—è', unit: '–º', price: 850, workPrice: 0, height: 0 },
            { id: 14, category: '–ü—Ä–æ—Ñ–∏–ª—å', name: '–°—Ç–µ–Ω–∞-–ü–æ—Ç–æ–ª–æ–∫', unit: '–º', price: 800, workPrice: 0, height: 0 },

            { id: 15, category: '–¢–∫–∞–Ω—å', name: '–ö–û–ú–§–û–†–¢', unit: '–º¬≤', price: 1650, workPrice: 1300, height: 3.25 },
            { id: 16, category: '–¢–∫–∞–Ω—å', name: '–ö–û–ú–§–û–†–¢ –ì1 –í1 –î2 –¢2', unit: '–º¬≤', price: 2900, workPrice: 1300, height: 3.25 },
            { id: 17, category: '–¢–∫–∞–Ω—å', name: '–õ–£–ù–ê', unit: '–º¬≤', price: 1800, workPrice: 1300, height: 2.9 },
            { id: 18, category: '–¢–∫–∞–Ω—å', name: '–ú–ê–†–°', unit: '–º¬≤', price: 1800, workPrice: 1300, height: 3.0 },
            { id: 19, category: '–¢–∫–∞–Ω—å', name: '–ö–û–ú–ï–¢–ê', unit: '–º¬≤', price: 1800, workPrice: 1300, height: 3.2 },
            { id: 20, category: '–¢–∫–∞–Ω—å', name: '–û–†–ï–û–ù', unit: '–º¬≤', price: 1800, workPrice: 1300, height: 2.95 },
            { id: 21, category: '–¢–∫–∞–Ω—å', name: 'FORM 138', unit: '–º¬≤', price: 1800, workPrice: 1300, height: 3.0 },
            { id: 22, category: '–¢–∫–∞–Ω—å', name: 'FORM 110', unit: '–º¬≤', price: 1800, workPrice: 1300, height: 2.95 },
            { id: 23, category: '–¢–∫–∞–Ω—å', name: '–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞', unit: '–º¬≤', price: 2000, workPrice: 1300, height: 2.9 },
            { id: 24, category: '–¢–∫–∞–Ω—å', name: '–ö–ª–∞—Å—Å–∏–∫–∞', unit: '–º¬≤', price: 2000, workPrice: 1300, height: 2.9 },
            { id: 25, category: '–¢–∫–∞–Ω—å', name: '–£–∑–æ—Ä', unit: '–º¬≤', price: 2000, workPrice: 1300, height: 3.2 },
            { id: 26, category: '–¢–∫–∞–Ω—å', name: '–ê–∫—É—Å—Ç–∏–∫', unit: '–º¬≤', price: 2000, workPrice: 1300, height: 3.2 },
            { id: 27, category: '–¢–∫–∞–Ω—å', name: '–í–∞—Ñ–ª—è', unit: '–º¬≤', price: 2200, workPrice: 1300, height: 3.2 },
            { id: 28, category: '–¢–∫–∞–Ω—å', name: 'Formtex', unit: '–º¬≤', price: 2700, workPrice: 1300, height: 5.1 },
            { id: 39, category: '–¢–∫–∞–Ω—å', name: '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ', unit: '–º¬≤', price: 0, workPrice: -1300, height: 10.25 },

            { id: 29, category: '–ú–µ–º–±—Ä–∞–Ω–∞', name: '–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è –ú–µ–º–±—Ä–∞–Ω–∞', unit: '–º¬≤', price: 500, workPrice: 0, height: 1.05 },
            { id: 30, category: '–ú–µ–º–±—Ä–∞–Ω–∞', name: '–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∏–π –í–æ–π–ª–æ–∫', unit: '–º¬≤', price: 1200, workPrice: 0, height: 1.5 },

            { id: 31, category: '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫', name: '–†–æ–Ω–¥–æ –ö—Ä–∞—Ç–µ—Ä –ë–∞–∑–∞', unit: '—à—Ç', price: 3500, workPrice: 600, height: 0 },
            { id: 32, category: '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫', name: '–†–æ–Ω–¥–æ –ö—Ä–∞—Ç–µ—Ä –ü–ª—é—Å', unit: '—à—Ç', price: 3500, workPrice: 600, height: 0 },
            { id: 33, category: '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫', name: '–†–∞—Å—Å–µ–∏–≤–∞—Ç–µ–ª—å –ß–µ—Ä–Ω—ã–π', unit: '–º', price: 350, workPrice: 0, height: 0 },

            { id: 34, category: '–ó–∞–∫–ª–∞–¥–Ω–∞—è', name: '–†–æ–Ω–¥–æ', unit: '—à—Ç', price: 400, workPrice: 600, height: 0 },
            { id: 35, category: '–ó–∞–∫–ª–∞–¥–Ω–∞—è', name: '–ú–∏–Ω–∏', unit: '—à—Ç', price: 450, workPrice: 450, height: 0 },
            { id: 36, category: '–ó–∞–∫–ª–∞–¥–Ω–∞—è', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', unit: '—à—Ç', price: 800, workPrice: 1000, height: 0 },
            { id: 37, category: '–ó–∞–∫–ª–∞–¥–Ω–∞—è', name: '–ü–æ—Ç–æ–ª–æ–∫', unit: '–º', price: 450, workPrice: 650, height: 0 },
            { id: 38, category: '–ó–∞–∫–ª–∞–¥–Ω–∞—è', name: '–ü–ª–∏–Ω—Ç—É—Å', unit: '–º', price: 400, workPrice: 600, height: 0 }
        ];

        let project = {
            name: '',
            address: '',
            clientName: '',
            clientPhone: '',
            objectType: '',
            roomCount: 1,
            rooms: [],
            currentRoom: 0,
            currentWall: 0
        };

        // ============ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ============
        window.onload = function() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            canvasWrapper = document.getElementById('canvasWrapper');

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
            document.getElementById('loginPassword').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    handleLogin();
                }
            });

            loadTools();
            loadLogoFromStorage();
            updateInfoPanel(); // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–Ω–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

            canvas.width = 2000;
            canvas.height = 1600;

            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseLeave);

            // –î–û–ë–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
            canvas.addEventListener('contextmenu', handleContextMenu);
            document.addEventListener('click', hideContextMenu);

            // –î–û–ë–ê–í–õ–ï–ù–û: –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ canvas
            canvas.oncontextmenu = function(e) {
                e.preventDefault();
                return false;
            };

            requestAnimationFrame(draw);
        };

        // –î–û–ë–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞
        function handleContextMenu(e) {
            e.preventDefault();
                
            if (!project.name) return;
                
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left) / zoom;
            const mouseY = (e.clientY - rect.top) / zoom;
                
            // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
            const foundElement = findElementAtPoint(mouseX, mouseY, true);
                
            if (foundElement) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —ç–ª–µ–º–µ–Ω—Ç–∞ –∏ –≤—ã–±–∏—Ä–∞–µ–º –µ–≥–æ
                contextElementId = foundElement.id;
                selectedElementId = foundElement.id;
                hoveredElement = foundElement;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
                const menu = document.getElementById('contextMenu');
                menu.style.left = e.clientX + 'px';
                menu.style.top = e.clientY + 'px';
                menu.classList.add('active');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                updateInfoPanel();
                updateElementList();
            } else {
                // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
                hideContextMenu();
            }
        }

        // –î–û–ë–ê–í–õ–ï–ù–û: –°–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function hideContextMenu() {
            const menu = document.getElementById('contextMenu');
            menu.classList.remove('active');
            contextElementId = null;
            // –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º hoveredElement –∏ selectedElementId –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–º –∫–ª–∏–∫–µ,
            // —á—Ç–æ–±—ã –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Å–Ω–∏–º–∞–ª–æ—Å—å —Å–ª—É—á–∞–π–Ω–æ.
        }

        // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        function duplicateContextElement() {
            let elementIdToDuplicate = contextElementId || selectedElementId;
            
            if (!elementIdToDuplicate) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            const sourceElement = elements.find(el => String(el.id) == String(elementIdToDuplicate));
        
            if (sourceElement) {
                const newElement = {
                    ...sourceElement,
                    id: `element_${Date.now()}_${elementIdCounter++}`,
                    startX: sourceElement.startX + 20,
                    startY: sourceElement.startY + 20,
                    endX: sourceElement.endX + 20,
                    endY: sourceElement.endY + 20,
                    roomId: project.currentRoom,
                    wallId: project.currentWall
                };
        
                calculateElementCost(newElement);
                elements.push(newElement);
        
                updateMaxWallHeight();
                updateElementList();
                updateTotalCost();
                autoSaveProject();
        
                hideContextMenu();
                showNotification('–≠–ª–µ–º–µ–Ω—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω');
            } else {
                alert('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }

        // –î–û–ë–ê–í–õ–ï–ù–û: –ü–æ–∫–∞–∑ —Å–≤–æ–π—Å—Ç–≤ —ç–ª–µ–º–µ–Ω—Ç–∞
        function showElementProperties() {
            let elementIdToShow = contextElementId || selectedElementId;
            
            if (!elementIdToShow) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–≤–æ–π—Å—Ç–≤');
                return;
            }
            
            const element = elements.find(el => String(el.id) == String(elementIdToShow));
        
            if (element) {
                let info = `–°–≤–æ–π—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–∞:\n\n`;
                info += `–¢–∏–ø: ${element.category}\n`;
                info += `–ù–∞–∑–≤–∞–Ω–∏–µ: ${element.name}\n`;
                info += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${element.quantity.toFixed(2)} ${element.unit}\n`;
                info += `–¶–µ–Ω–∞: ${element.price} ‚ÇΩ/${element.unit}\n`;
                info += `–°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${element.materialCost.toFixed(0)} ‚ÇΩ\n`;
                info += `–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç: ${element.laborCost.toFixed(0)} ‚ÇΩ\n`;
                info += `–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${element.totalCost.toFixed(0)} ‚ÇΩ`;
        
                alert(info);
                hideContextMenu();
            } else {
                alert('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }

        // –î–û–ë–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 12px 20px;
                border-radius: 6px;
                font-size: 14px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // –î–û–ë–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç —Ç–æ—á–∫–∏ –¥–æ –ª–∏–Ω–∏–∏
        function distanceToLine(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;

            const dot = A * C + B * D;
            const lenSq = C * C + D * D;
            let param = -1;

            if (lenSq !== 0) {
                param = dot / lenSq;
            }

            let xx, yy;

            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }

            const dx = px - xx;
            const dy = py - yy;

            return Math.sqrt(dx * dx + dy * dy);
        }

        function checkIfToolDisabled(tool) {
            if (tool.category === '–¢–∫–∞–Ω—å' && maxWallHeight > 0) {
                return tool.height < maxWallHeight;
            }
            return false;
        }

        function loadTools() {
            const container = document.getElementById('toolsContainer');
            const categories = {};

            toolsDatabase.forEach(tool => {
                if (!categories[tool.category]) {
                    categories[tool.category] = [];
                }
                categories[tool.category].push(tool);
            });

            let html = '';
            Object.keys(categories).forEach(category => {
                html += `
                    <div class="tool-category">
                        <button class="category-btn" onclick="toggleCategory('${category}')">
                            ${getCategoryIcon(category)} ${category}
                        </button>
                        <div id="${category}-tools" class="tool-list">
                            ${categories[category].map(tool => {
                                const isDisabled = checkIfToolDisabled(tool);
                                const tooltipText = isDisabled ? '–í—ã—Å–æ—Ç–∞ —Ç–∫–∞–Ω–∏ (' + tool.height + '–º) –º–µ–Ω—å—à–µ –≤—ã—Å–æ—Ç—ã —Å—Ç–µ–Ω—ã (' + maxWallHeight.toFixed(2) + '–º)' : '';
                                return `
                                    <div class="tool-item ${isDisabled ? 'disabled' : ''}"
                                         onclick='${isDisabled ? '' : `selectTool(${JSON.stringify(tool)})`}'
                                         title="${tooltipText}">
                                        <span>${tool.name}${tool.height > 0 && tool.category === '–¢–∫–∞–Ω—å' ? ' (' + tool.height + '–º)' : ''}</span>
                                        <span class="tool-price">${tool.price}‚ÇΩ/${tool.unit}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function getCategoryIcon(category) {
            const icons = {
                '–ü—Ä–æ—Ñ–∏–ª—å': 'üìè',
                '–¢–∫–∞–Ω—å': 'üé®',
                '–ú–µ–º–±—Ä–∞–Ω–∞': 'üîä',
                '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫': 'üí°',
                '–ó–∞–∫–ª–∞–¥–Ω–∞—è': 'üîß'
            };
            return icons[category] || '‚Ä¢';
        }

        function toggleCategory(category) {
            const toolList = document.getElementById(category + '-tools');
            const allLists = document.querySelectorAll('.tool-list');
            const btn = event.target;

            allLists.forEach(list => {
                if (list !== toolList) {
                    list.classList.remove('active');
                }
            });

            document.querySelectorAll('.category-btn').forEach(b => {
                if (b !== btn) b.classList.remove('active');
            });

            toolList.classList.toggle('active');
            btn.classList.toggle('active');
        }

        function selectTool(tool) {
            currentTool = tool;

            document.querySelectorAll('.tool-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.classList.add('selected');

            canvas.style.cursor = 'crosshair';
        }

        function zoomIn() {
            zoom = Math.min(zoom + 0.2, 3);
            applyZoom();
        }

        function zoomOut() {
            zoom = Math.max(zoom - 0.2, 0.5);
            applyZoom();
        }

        function resetZoom() {
            zoom = 1;
            applyZoom();
        }

        function applyZoom() {
            canvas.style.transform = `scale(${zoom})`;
            canvas.style.transformOrigin = 'top left';
            document.getElementById('zoomLevel').textContent = Math.round(zoom * 100) + '%';
        }

        function handleMouseDown(e) {
            // –ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Shift + –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫
            if (e.button === 2 && e.shiftKey) {
                e.preventDefault();
        
                const rect = canvas.getBoundingClientRect();
                const mouseX = (e.clientX - rect.left) / zoom;
                const mouseY = (e.clientY - rect.top) / zoom;
        
                const elementToDelete = findElementAtPoint(mouseX, mouseY, true);
        
                if (elementToDelete) {
                    executeDelete(elementToDelete.id); // –ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                }
                return;
            }
        
            // –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ (–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
            if (e.button === 2) {
                e.preventDefault();
                
                const rect = canvas.getBoundingClientRect();
                const mouseX = (e.clientX - rect.left) / zoom;
                const mouseY = (e.clientY - rect.top) / zoom;
                
                // –í—ã–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
                selectElementAtPoint(mouseX, mouseY);
                return;
            }
        
            if (e.button !== 0) return;
        
            if (!currentTool || !project.name) return;
        
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left) / zoom;
            const mouseY = (e.clientY - rect.top) / zoom;
        
            const clickedElement = findElementAtPoint(mouseX, mouseY);
        
            if (clickedElement && isBackingDraggable(clickedElement)) {
                isDragging = true;
                draggedElement = clickedElement;
                dragOffsetX = mouseX - clickedElement.startX;
                dragOffsetY = mouseY - clickedElement.startY;
                canvas.style.cursor = 'move';
                return;
            }
        
            startX = snapToGrid(mouseX);
            startY = snapToGrid(mouseY);
        
            if (currentTool.category === '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫' ||
                (currentTool.category === '–ó–∞–∫–ª–∞–¥–Ω–∞—è' && ['–†–æ–Ω–¥–æ', '–ú–∏–Ω–∏', '–°—Ç–∞–Ω–¥–∞—Ä—Ç'].includes(currentTool.name))) {
                createElement(startX, startY, startX, startY);
            } else {
                isDrawing = true;
            }
        }

        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left) / zoom;
            const mouseY = (e.clientY - rect.top) / zoom;

            if (isDragging && draggedElement) {
                const newX = snapToGrid(mouseX - dragOffsetX);
                const newY = snapToGrid(mouseY - dragOffsetY);

                draggedElement.startX = newX;
                draggedElement.startY = newY;

                showMeasurementTooltip(e.clientX, e.clientY, `X: ${(newX / pixelsPerCm).toFixed(1)}—Å–º, Y: ${(newY / pixelsPerCm).toFixed(1)}—Å–º`);
                return;
            }

            if (isDrawing && currentTool) {
                const endX = snapToGrid(mouseX);
                const endY = snapToGrid(mouseY);

                currentElement = {
                    ...currentTool,
                    startX: startX,
                    startY: startY,
                    endX: endX,
                    endY: endY,
                    roomId: project.currentRoom,
                    wallId: project.currentWall
                };

                showMeasurementTooltip(e.clientX, e.clientY, getMeasurementText(currentElement));
            }
        }

        function handleMouseUp(e) {
            if (e.button === 2) {
                e.preventDefault();
                return; // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞ —É–∂–µ –≤ contextmenu –∏ mousedown
            }
        
            if (isDragging) {
                isDragging = false;
                draggedElement = null;
                canvas.style.cursor = 'crosshair';
                hideMeasurementTooltip();
                updateElementList();
                updateTotalCost();
                autoSaveProject();
                return;
            }
        
            if (!isDrawing || !currentTool) return;
        
            const rect = canvas.getBoundingClientRect();
            const endX = snapToGrid((e.clientX - rect.left) / zoom);
            const endY = snapToGrid((e.clientY - rect.top) / zoom);
        
            const minSize = gridSize * 2;
            if (Math.abs(endX - startX) > minSize || Math.abs(endY - startY) > minSize) {
                createElement(startX, startY, endX, endY);
            }
        
            isDrawing = false;
            currentElement = null;
            hideMeasurementTooltip();
        }

        function handleMouseLeave() {
            if (isDrawing) {
                isDrawing = false;
                currentElement = null;
            }
            hideMeasurementTooltip();
        }

        // –ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–ù–û: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
        function findElementAtPoint(x, y, includeAll = false) {
            let foundElement = null;
            let minDistance = Infinity;
        
            for (let i = elements.length - 1; i >= 0; i--) {
                const el = elements[i];
        
                if (el.roomId != project.currentRoom || el.wallId != project.currentWall) {
                    continue;
                }
        
                let distance = Infinity;
        
                // –î–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ç–∏–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                if (includeAll) {
                    switch(el.category) {
                        case '–ü—Ä–æ—Ñ–∏–ª—å':
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –ª–∏–Ω–∏–∏
                            distance = distanceToLine(x, y, el.startX, el.startY, el.endX, el.endY);
                            if (distance < 10 && distance < minDistance) {
                                foundElement = el;
                                minDistance = distance;
                            }
                            break;
        
                        case '–¢–∫–∞–Ω—å':
                        case '–ú–µ–º–±—Ä–∞–Ω–∞':
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
                            const minX = Math.min(el.startX, el.endX);
                            const maxX = Math.max(el.startX, el.endX);
                            const minY = Math.min(el.startY, el.endY);
                            const maxY = Math.max(el.startY, el.endY);
        
                            if (x >= minX && x <= maxX && y >= minY && y <= maxY) {
                                // –î–ª—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–∞
                                const centerX = (minX + maxX) / 2;
                                const centerY = (minY + maxY) / 2;
                                distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
                                if (distance < minDistance) {
                                    foundElement = el;
                                    minDistance = distance;
                                }
                            }
                            break;
        
                        case '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫':
                            distance = Math.sqrt(Math.pow(x - el.startX, 2) + Math.pow(y - el.startY, 2));
                            if (distance < 20 && distance < minDistance) {
                                foundElement = el;
                                minDistance = distance;
                            }
                            break;
        
                        case '–ó–∞–∫–ª–∞–¥–Ω–∞—è':
                            if (['–†–æ–Ω–¥–æ', '–ú–∏–Ω–∏', '–°—Ç–∞–Ω–¥–∞—Ä—Ç'].includes(el.name)) {
                                distance = Math.sqrt(Math.pow(x - el.startX, 2) + Math.pow(y - el.startY, 2));
                                if (distance < 30 && distance < minDistance) {
                                    foundElement = el;
                                    minDistance = distance;
                                }
                            } else if (['–ü–æ—Ç–æ–ª–æ–∫', '–ü–ª–∏–Ω—Ç—É—Å'].includes(el.name)) {
                                distance = distanceToLine(x, y, el.startX, el.startY, el.endX, el.endY);
                                if (distance < 10 && distance < minDistance) {
                                    foundElement = el;
                                    minDistance = distance;
                                }
                            }
                            break;
                    }
                } else {
                    // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                    if (el.category === '–ó–∞–∫–ª–∞–¥–Ω–∞—è') {
                        if (['–†–æ–Ω–¥–æ', '–ú–∏–Ω–∏', '–°—Ç–∞–Ω–¥–∞—Ä—Ç'].includes(el.name)) {
                            distance = Math.sqrt(Math.pow(x - el.startX, 2) + Math.pow(y - el.startY, 2));
                            if (distance < 30 && distance < minDistance) {
                                foundElement = el;
                                minDistance = distance;
                            }
                        }
                    } else if (el.category === '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫') {
                        distance = Math.sqrt(Math.pow(x - el.startX, 2) + Math.pow(y - el.startY, 2));
                        if (distance < 20 && distance < minDistance) {
                            foundElement = el;
                            minDistance = distance;
                        }
                    }
                }
            }
            
            return foundElement;
        }
        
        // –î–û–ë–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
        function selectElementAtPoint(x, y) {
            const element = findElementAtPoint(x, y, true);
            
            if (element) {
                selectedElementId = element.id;
                contextElementId = element.id;
                hoveredElement = element;
                
                updateElementList();
                updateInfoPanel();
                
                return element;
            } else {
                // –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
                // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–Ω—è—Ç–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ
                // selectedElementId, contextElementId –∏ hoveredElement –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏
                
                updateElementList();
                updateInfoPanel();
                
                return null;
            }
        }
        
        // –î–û–ë–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–Ω—è—Ç–∏—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
        function deselectElement() {
            selectedElementId = null;
            contextElementId = null;
            hoveredElement = null;
            
            updateElementList();
            updateInfoPanel();
        }

        function isBackingDraggable(element) {
            return element.category === '–ó–∞–∫–ª–∞–¥–Ω–∞—è' && ['–†–æ–Ω–¥–æ', '–ú–∏–Ω–∏', '–°—Ç–∞–Ω–¥–∞—Ä—Ç'].includes(element.name) ||
                   element.category === '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫';
        }

        function showMeasurementTooltip(x, y, text) {
            const tooltip = document.getElementById('measurementTooltip');
            tooltip.textContent = text;
            tooltip.style.left = (x + 20) + 'px';
            tooltip.style.top = (y - 40) + 'px';
            tooltip.style.display = 'block';
        }

        function hideMeasurementTooltip() {
            document.getElementById('measurementTooltip').style.display = 'none';
        }

        function getMeasurementText(element) {
            if (!element) return '';

            switch(element.category) {
                case '–ü—Ä–æ—Ñ–∏–ª—å':
                    const length = Math.sqrt(
                        Math.pow(element.endX - element.startX, 2) +
                        Math.pow(element.endY - element.startY, 2)
                    ) / pixelsPerCm;
                    return `–î–ª–∏–Ω–∞: ${length.toFixed(1)} —Å–º (${(length / 100).toFixed(2)} –º)`;

                case '–¢–∫–∞–Ω—å':
                case '–ú–µ–º–±—Ä–∞–Ω–∞':
                    const width = Math.abs(element.endX - element.startX) / pixelsPerCm;
                    const height = Math.abs(element.endY - element.startY) / pixelsPerCm;
                    return `–†–∞–∑–º–µ—Ä: ${width.toFixed(1)} √ó ${height.toFixed(1)} —Å–º`;

                case '–ó–∞–∫–ª–∞–¥–Ω–∞—è':
                    if (['–ü–æ—Ç–æ–ª–æ–∫', '–ü–ª–∏–Ω—Ç—É—Å'].includes(element.name)) {
                        const len = Math.sqrt(
                            Math.pow(element.endX - element.startX, 2) +
                            Math.pow(element.endY - element.startY, 2)
                        ) / pixelsPerCm;
                        return `–î–ª–∏–Ω–∞: ${len.toFixed(1)} —Å–º (${(len / 100).toFixed(2)} –º)`;
                    }
                    return element.name;

                default:
                    return element.name;
            }
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ ID
        function createElement(x1, y1, x2, y2) {
            // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –æ–±—ä–µ–∫—Ç–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ —É–¥–∞–ª—è–µ–º –µ–≥–æ ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö,
            // —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID —ç–ª–µ–º–µ–Ω—Ç–∞.
            const toolProps = { ...currentTool };
            delete toolProps.id;
        
            const element = {
                ...toolProps,
                id: `element_${Date.now()}_${elementIdCounter++}`,
                startX: x1,
                startY: y1,
                endX: x2,
                endY: y2,
                roomId: project.currentRoom,
                wallId: project.currentWall
            };
        
            calculateElementCost(element);
        
            elements.push(element);
        
            updateMaxWallHeight();
        
            updateElementList();
            updateTotalCost();
            autoSaveProject();
        }

        // –ò–ó–ú–ï–ù–ï–ù–û: –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã —Å—Ç–µ–Ω—ã –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç–∫–∞–Ω–∏
        function updateMaxWallHeight() {
            const currentWallProfiles = elements.filter(el =>
                el.roomId == project.currentRoom &&
                el.wallId == project.currentWall &&
                el.category === '–ü—Ä–æ—Ñ–∏–ª—å'
            );
        
            if (currentWallProfiles.length === 0) {
                maxWallHeight = 0;
                loadTools();
                return;
            }
        
            let minY = Infinity;
            let maxY = -Infinity;
        
            currentWallProfiles.forEach(el => {
                minY = Math.min(minY, el.startY, el.endY);
                maxY = Math.max(maxY, el.startY, el.endY);
            });
        
            if (isFinite(minY) && isFinite(maxY)) {
                maxWallHeight = (maxY - minY) / pixelsPerMeter;
            } else {
                maxWallHeight = 0;
            }
        
            loadTools();
        }

        function calculateElementCost(element) {
                    let quantity = 0;
        
                    switch(element.category) {
                        case '–ü—Ä–æ—Ñ–∏–ª—å':
                            const length = Math.sqrt(
                                Math.pow(element.endX - element.startX, 2) +
                                Math.pow(element.endY - element.startY, 2)
                            ) / pixelsPerMeter;
                            quantity = length;
                            break;
        
                        case '–¢–∫–∞–Ω—å':
                            const fabricWidth = Math.abs(element.endX - element.startX) / pixelsPerMeter;
                            // –î–ª—è —Ç–∫–∞–Ω–∏ "–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ" –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –≤—ã—Å–æ—Ç—É, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                            let fabricHeight;
                            if (element.name === '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                                fabricHeight = Math.abs(element.endY - element.startY) / pixelsPerMeter;
                            } else {
                                fabricHeight = getFabricHeightFromDatabase(element.name);
                            }
                            quantity = fabricWidth * fabricHeight;
                            element.calculatedWidth = fabricWidth;
                            element.calculatedHeight = fabricHeight;
                            break;
                        case '–ú–µ–º–±—Ä–∞–Ω–∞':
                            const membraneWidth = Math.abs(element.endX - element.startX) / pixelsPerMeter;
                            const membraneHeight = Math.abs(element.endY - element.startY) / pixelsPerMeter;
                            quantity = membraneWidth * membraneHeight;
                            element.calculatedWidth = membraneWidth;
                            element.calculatedHeight = membraneHeight;
                            break;
        
                        case '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫':
                            quantity = 1;
                            break;
        
                        case '–ó–∞–∫–ª–∞–¥–Ω–∞—è':
                            if (['–ü–æ—Ç–æ–ª–æ–∫', '–ü–ª–∏–Ω—Ç—É—Å'].includes(element.name)) {
                                const len = Math.sqrt(
                                    Math.pow(element.endX - element.startX, 2) +
                                    Math.pow(element.endY - element.startY, 2)
                                ) / pixelsPerMeter;
                                quantity = len;
                            } else {
                                quantity = 1;
                            }
                            break;
                    }
        
                    element.quantity = quantity;
                    element.materialCost = quantity * element.price;
                    element.laborCost = quantity * element.workPrice;
                    element.totalCost = element.materialCost + element.laborCost;
                }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã —Ç–∫–∞–Ω–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
        function getFabricHeightFromDatabase(fabricName) {
            const fabricTool = toolsDatabase.find(tool =>
                tool.category === '–¢–∫–∞–Ω—å' && tool.name === fabricName
            );
            return fabricTool ? fabricTool.height : 0;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏ —Ç–∫–∞–Ω–∏ –∏ —Ä–∞–±–æ—Ç—ã –ø–æ —Ç–∫–∞–Ω–∏
                function getFabricAreaAndWorkCost() {
                    let totalFabricArea = 0;
                    let totalFabricWorkCost = 0;
        
                    elements.forEach(element => {
                        if (element.category === '–¢–∫–∞–Ω—å' && element.name !== '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                            totalFabricArea += element.quantity;
                            totalFabricWorkCost += element.quantity * element.workPrice;
                        }
                    });
        
                    return { totalFabricArea, totalFabricWorkCost };
                }
        
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏ "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ"
                function getExcessRemovalArea() {
                    let totalExcessRemovalArea = 0;
        
                    elements.forEach(element => {
                        if (element.category === '–¢–∫–∞–Ω—å' && element.name === '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                            totalExcessRemovalArea += element.quantity;
                        }
                    });
        
                    return totalExcessRemovalArea;
                }
        
                // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                function updateTotalCost() {
                    let materialCost = 0;
                    let workCost = 0;
        
                    const profileGroups = {};
        
                    // –°–Ω–∞—á–∞–ª–∞ —Å—É–º–º–∏—Ä—É–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∫—Ä–æ–º–µ —Ç–∫–∞–Ω–∏
                    elements.forEach(element => {
                        if (element.category === '–ü—Ä–æ—Ñ–∏–ª—å') {
                            if (!profileGroups[element.name]) {
                                profileGroups[element.name] = {
                                    totalLength: 0,
                                    price: element.price,
                                    workPrice: element.workPrice,
                                    unit: element.unit
                                };
                            }
                            profileGroups[element.name].totalLength += element.quantity;
                        } else if (element.category !== '–¢–∫–∞–Ω—å') {
                            // –î–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∫—Ä–æ–º–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Ç–∫–∞–Ω–∏
                            materialCost += element.materialCost || 0;
                            workCost += element.laborCost || 0;
                        }
                    });
        
                    // –ó–∞—Ç–µ–º —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–∫–∞–Ω–∏ —Å —É—á–µ—Ç–æ–º "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ"
                    const { totalFabricArea, totalFabricWorkCost } = getFabricAreaAndWorkCost();
                    const excessRemovalArea = getExcessRemovalArea();
        
                    // –í—ã—á–∏—Å–ª—è–µ–º —á–∏—Å—Ç—É—é –ø–ª–æ—â–∞–¥—å —Ç–∫–∞–Ω–∏ (–æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å –º–∏–Ω—É—Å –ø–ª–æ—â–∞–¥—å "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ")
                    const netFabricArea = Math.max(0, totalFabricArea - excessRemovalArea);
        
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è —Ç–∫–∞–Ω–∏ (—Ü–µ–Ω–∞ –∑–∞ –º¬≤ * –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å)
                    let fabricMaterialCost = 0;
                    elements.forEach(element => {
                        if (element.category === '–¢–∫–∞–Ω—å' && element.name !== '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                            fabricMaterialCost += element.quantity * element.price;
                        }
                    });
        
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –¥–ª—è —Ç–∫–∞–Ω–∏ (—Ü–µ–Ω–∞ —Ä–∞–±–æ—Ç—ã –∑–∞ –º¬≤ * —á–∏—Å—Ç–∞—è –ø–ª–æ—â–∞–¥—å)
                    const netFabricWorkCost = netFabricArea * 1300; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ workPrice –¥–ª—è —Ç–∫–∞–Ω–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 1300 –∑–∞ –º¬≤
        
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–∫–∞–Ω–∏ –∫ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    materialCost += fabricMaterialCost;
                    workCost += netFabricWorkCost;
        
                    // –î–û–ë–ê–í–õ–ï–ù–û: –£—á–µ—Ç —Ä—É—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
                    manualEstimateItems.forEach(item => {
                        materialCost += item.materialCost || 0;
                        workCost += item.laborCost || 0;
                    });
        
                    let profileListHtml = '';
                    Object.keys(profileGroups).forEach(profileName => {
                        const group = profileGroups[profileName];
                        const roundedLength = Math.ceil(group.totalLength / 2) * 2;
                        const profileMaterialCost = roundedLength * group.price;
                        const profileWorkCost = roundedLength * group.workPrice;
        
                        materialCost += profileMaterialCost;
                        workCost += profileWorkCost;
        
                        profileListHtml += `
                            <div class="profile-item">
                                <span>${profileName}:</span>
                                <span>${group.totalLength.toFixed(2)}–º ‚Üí ${roundedLength}–º (${profileMaterialCost.toFixed(0)}‚ÇΩ)</span>
                            </div>
                        `;
                    });
        
                    if (profileListHtml) {
                        document.getElementById('profileSummary').style.display = 'block';
                        document.getElementById('profileList').innerHTML = profileListHtml;
                    } else {
                        document.getElementById('profileSummary').style.display = 'none';
                    }
        
                    document.getElementById('materialCost').textContent = materialCost.toFixed(0) + ' ‚ÇΩ';
                    document.getElementById('workCost').textContent = workCost.toFixed(0) + ' ‚ÇΩ';
                    document.getElementById('totalCost').textContent = (materialCost + workCost).toFixed(0) + ' ‚ÇΩ';
                }
        
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏ —Ç–∫–∞–Ω–∏ –∏ —Ä–∞–±–æ—Ç—ã –ø–æ —Ç–∫–∞–Ω–∏
                function getFabricAreaAndWorkCost() {
                    let totalFabricArea = 0;
                    let totalFabricWorkCost = 0;
        
                    elements.forEach(element => {
                        if (element.category === '–¢–∫–∞–Ω—å' && element.name !== '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                            totalFabricArea += element.quantity;
                            totalFabricWorkCost += element.quantity * element.workPrice;
                        }
                    });
        
                    return { totalFabricArea, totalFabricWorkCost };
                }
        
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏ "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ"
                function getExcessRemovalArea() {
                    let totalExcessRemovalArea = 0;
        
                    elements.forEach(element => {
                        if (element.category === '–¢–∫–∞–Ω—å' && element.name === '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                            totalExcessRemovalArea += element.quantity;
                        }
                    });
        
                    return totalExcessRemovalArea;
                }
        
                // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                function updateTotalCost() {
                    let materialCost = 0;
                    let workCost = 0;
        
                    const profileGroups = {};
        
                    // –°–Ω–∞—á–∞–ª–∞ —Å—É–º–º–∏—Ä—É–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∫—Ä–æ–º–µ —Ç–∫–∞–Ω–∏
                    elements.forEach(element => {
                        if (element.category === '–ü—Ä–æ—Ñ–∏–ª—å') {
                            if (!profileGroups[element.name]) {
                                profileGroups[element.name] = {
                                    totalLength: 0,
                                    price: element.price,
                                    workPrice: element.workPrice,
                                    unit: element.unit
                                };
                            }
                            profileGroups[element.name].totalLength += element.quantity;
                        } else if (element.category !== '–¢–∫–∞–Ω—å') {
                            // –î–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∫—Ä–æ–º–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Ç–∫–∞–Ω–∏
                            materialCost += element.materialCost || 0;
                            workCost += element.laborCost || 0;
                        }
                    });
        
                    // –ó–∞—Ç–µ–º —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–∫–∞–Ω–∏ —Å —É—á–µ—Ç–æ–º "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ"
                    const { totalFabricArea, totalFabricWorkCost } = getFabricAreaAndWorkCost();
                    const excessRemovalArea = getExcessRemovalArea();
        
                    // –í—ã—á–∏—Å–ª—è–µ–º —á–∏—Å—Ç—É—é –ø–ª–æ—â–∞–¥—å —Ç–∫–∞–Ω–∏ (–æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å –º–∏–Ω—É—Å –ø–ª–æ—â–∞–¥—å "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ")
                    const netFabricArea = Math.max(0, totalFabricArea - excessRemovalArea);
        
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è —Ç–∫–∞–Ω–∏ (—Ü–µ–Ω–∞ –∑–∞ –º¬≤ * –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å)
                    let fabricMaterialCost = 0;
                    elements.forEach(element => {
                        if (element.category === '–¢–∫–∞–Ω—å' && element.name !== '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                            fabricMaterialCost += element.quantity * element.price;
                        }
                    });
        
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –¥–ª—è —Ç–∫–∞–Ω–∏ (—Ü–µ–Ω–∞ —Ä–∞–±–æ—Ç—ã –∑–∞ –º¬≤ * —á–∏—Å—Ç–∞—è –ø–ª–æ—â–∞–¥—å)
                    const netFabricWorkCost = netFabricArea * 1300; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ workPrice –¥–ª—è —Ç–∫–∞–Ω–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 1300 –∑–∞ –º¬≤
        
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–∫–∞–Ω–∏ –∫ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    materialCost += fabricMaterialCost;
                    workCost += netFabricWorkCost;
        
                    // –î–û–ë–ê–í–õ–ï–ù–û: –£—á–µ—Ç —Ä—É—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
                    manualEstimateItems.forEach(item => {
                        materialCost += item.materialCost || 0;
                        workCost += item.laborCost || 0;
                    });
        
                    let profileListHtml = '';
                    Object.keys(profileGroups).forEach(profileName => {
                        const group = profileGroups[profileName];
                        const roundedLength = Math.ceil(group.totalLength / 2) * 2;
                        const profileMaterialCost = roundedLength * group.price;
                        const profileWorkCost = roundedLength * group.workPrice;
        
                        materialCost += profileMaterialCost;
                        workCost += profileWorkCost;
        
                        profileListHtml += `
                            <div class="profile-item">
                                <span>${profileName}:</span>
                                <span>${group.totalLength.toFixed(2)}–º ‚Üí ${roundedLength}–º (${profileMaterialCost.toFixed(0)}‚ÇΩ)</span>
                            </div>
                        `;
                    });
        
                    if (profileListHtml) {
                        document.getElementById('profileSummary').style.display = 'block';
                        document.getElementById('profileList').innerHTML = profileListHtml;
                    } else {
                        document.getElementById('profileSummary').style.display = 'none';
                    }
        
                    document.getElementById('materialCost').textContent = materialCost.toFixed(0) + ' ‚ÇΩ';
                    document.getElementById('workCost').textContent = workCost.toFixed(0) + ' ‚ÇΩ';
                    document.getElementById('totalCost').textContent = (materialCost + workCost).toFixed(0) + ' ‚ÇΩ';
                }

        function snapToGrid(value) {
            return Math.round(value / gridSize) * gridSize;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        
            drawGrid();
        
            elements.forEach(element => {
                if (element.roomId == project.currentRoom &&
                    element.wallId == project.currentWall) {
                    // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                    const isSelected = String(selectedElementId) == String(element.id);
                    const isHovered = hoveredElement && String(hoveredElement.id) == String(element.id);
                    const isContext = String(contextElementId) == String(element.id);
                    drawElement(element, false, isSelected, isHovered, isContext);
                }
            });
        
            if (currentElement && isDrawing) {
                drawElement(currentElement, true);
            }
        
            if (isDragging && draggedElement) {
                drawDragHighlight(draggedElement);
            }
        
            requestAnimationFrame(draw);
        }

        function drawGrid() {
            const offsetX = 0;
            const offsetY = 0;

            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 0.5;

            for (let x = offsetX; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            for (let y = offsetY; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            ctx.strokeStyle = '#d8d8d8';
            ctx.lineWidth = 1;

            for (let x = offsetX; x <= canvas.width; x += gridSize * 10) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            for (let y = offsetY; y <= canvas.height; y += gridSize * 10) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            ctx.strokeStyle = '#b0b0b0';
            ctx.lineWidth = 2;

            for (let x = offsetX; x <= canvas.width; x += pixelsPerMeter) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();

                if (x > 0) {
                    ctx.fillStyle = '#666';
                    ctx.font = 'bold 11px Arial';
                    ctx.fillText((x / pixelsPerMeter) + 'm', x + 3, 15);
                }
            }

            for (let y = offsetY; y <= canvas.height; y += pixelsPerMeter) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();

                if (y > 0) {
                    ctx.fillStyle = '#666';
                    ctx.font = 'bold 11px Arial';
                    ctx.fillText((y / pixelsPerMeter) + 'm', 3, y - 3);
                }
            }
        }

        function drawElement(element, isPreview = false, isSelected = false, isHovered = false) {
            ctx.save();
        
            const colors = {
                '–ü—Ä–æ—Ñ–∏–ª—å': '#000000',
                '–¢–∫–∞–Ω—å': '#4A90E2',
                '–ú–µ–º–±—Ä–∞–Ω–∞': '#FF6B35',
                '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫': '#00C853',
                '–ó–∞–∫–ª–∞–¥–Ω–∞—è': '#FF1744'
            };
        
            let color = colors[element.category];
        
            if (element.category === '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫' && element.name === '–†–∞—Å—Å–µ–∏–≤–∞—Ç–µ–ª—å –ß–µ—Ä–Ω—ã–π') {
                color = '#FFD700';
            }
        
            if (element.category === '–¢–∫–∞–Ω—å' && element.name === '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                            // –î–ª—è "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ" —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
                            ctx.strokeStyle = '#000000';
                            ctx.fillStyle = '#000000';
                            ctx.globalAlpha = 0.1; // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
                        } else {
                            ctx.strokeStyle = color;
                            ctx.fillStyle = color;
                            ctx.globalAlpha = isPreview ? 0.6 : 1; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                        }
        
            if (isPreview) {
                ctx.globalAlpha = 0.6;
            }
        
            switch(element.category) {
                case '–ü—Ä–æ—Ñ–∏–ª—å':
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(element.startX, element.startY);
                    ctx.lineTo(element.endX, element.endY);
                    ctx.stroke();
        
                    if (!isPreview && element.quantity) {
                        const midX = (element.startX + element.endX) / 2;
                        const midY = (element.startY + element.endY) / 2;
        
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                        const text = `${element.quantity.toFixed(2)} –º`;
                        ctx.font = '13px Arial';
                        const metrics = ctx.measureText(text);
                        ctx.fillRect(midX - metrics.width/2 - 6, midY - 16, metrics.width + 12, 22);
        
                        ctx.fillStyle = '#000';
                        ctx.font = 'bold 13px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(text, midX, midY);
                    }
                    break;
        
                case '–¢–∫–∞–Ω—å':
                case '–ú–µ–º–±—Ä–∞–Ω–∞':
                    ctx.globalAlpha = 0.3;
                    ctx.fillRect(
                        Math.min(element.startX, element.endX),
                        Math.min(element.startY, element.endY),
                        Math.abs(element.endX - element.startX),
                        Math.abs(element.endY - element.startY)
                    );
                    ctx.globalAlpha = 1;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(
                        Math.min(element.startX, element.endX),
                        Math.min(element.startY, element.endY),
                        Math.abs(element.endX - element.startX),
                        Math.abs(element.endY - element.startY)
                    );
        
                    if (!isPreview && element.quantity) {
                        const centerX = (element.startX + element.endX) / 2;
                        const centerY = (element.startY + element.endY) / 2;
        
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                        ctx.fillRect(centerX - 50, centerY - 25, 100, 50);
                        ctx.fillStyle = color;
                        ctx.font = '11px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(`–î–ª–∏–Ω–∞: ${element.calculatedWidth.toFixed(2)}–º`, centerX, centerY - 10);
                        ctx.fillText(`–í—ã—Å–æ—Ç–∞: ${element.calculatedHeight.toFixed(2)}–º`, centerX, centerY + 5);
                        ctx.font = 'bold 12px Arial';
                        ctx.fillText(`${element.quantity.toFixed(2)} –º¬≤`, centerX, centerY + 20);
                    }
                    break;
        
                case '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫':
                    if (element.name === '–†–∞—Å—Å–µ–∏–≤–∞—Ç–µ–ª—å –ß–µ—Ä–Ω—ã–π') {
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        ctx.moveTo(element.startX, element.startY);
                        ctx.lineTo(element.endX, element.endY);
                        ctx.stroke();
                    } else {
                        ctx.beginPath();
                        ctx.arc(element.startX, element.startY, 15, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.strokeStyle = '#fff';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                    break;
        
                case '–ó–∞–∫–ª–∞–¥–Ω–∞—è':
                    if (element.name === '–†–æ–Ω–¥–æ') {
                        ctx.beginPath();
                        ctx.arc(element.startX - 6, element.startY, 6, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.arc(element.startX + 6, element.startY, 6, 0, Math.PI * 2);
                        ctx.fill();
                    } else if (element.name === '–ú–∏–Ω–∏') {
                        ctx.fillRect(element.startX - 8, element.startY - 8, 16, 16);
                    } else if (element.name === '–°—Ç–∞–Ω–¥–∞—Ä—Ç') {
                        ctx.fillRect(element.startX - 12, element.startY - 12, 24);
                    } else if (element.name === '–ü–æ—Ç–æ–ª–æ–∫') {
                        ctx.lineWidth = 6;
                        ctx.beginPath();
                        ctx.moveTo(element.startX, element.startY);
                        ctx.lineTo(element.endX, element.endY);
                        ctx.stroke();
                    } else if (element.name === '–ü–ª–∏–Ω—Ç—É—Å') {
                        ctx.lineWidth = 3;
                        ctx.setLineDash([10, 5]);
                        ctx.beginPath();
                        ctx.moveTo(element.startX, element.startY);
                        ctx.lineTo(element.endX, element.endY);
                        ctx.stroke();
                        ctx.setLineDash([]);
                    }
                    break;
            }
        
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            if (isSelected || isHovered) {
                ctx.strokeStyle = isHovered ? '#667eea' : '#FFD700';
                ctx.lineWidth = isHovered ? 3 : 4;
                ctx.setLineDash(isHovered ? [5, 5] : [8, 4]);
        
                switch(element.category) {
                    case '–ü—Ä–æ—Ñ–∏–ª—å':
                        // –û–±–≤–æ–¥–∫–∞ –≤–æ–∫—Ä—É–≥ –ª–∏–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
                        const dx = element.endX - element.startX;
                        const dy = element.endY - element.startY;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        const nx = -dy / length * 10;
                        const ny = dx / length * 10;
        
                        ctx.beginPath();
                        ctx.moveTo(element.startX + nx, element.startY + ny);
                        ctx.lineTo(element.endX + nx, element.endY + ny);
                        ctx.lineTo(element.endX - nx, element.endY - ny);
                        ctx.lineTo(element.startX - nx, element.startY - ny);
                        ctx.closePath();
                        ctx.stroke();
                        break;
        
                    case '–¢–∫–∞–Ω—å':
                    case '–ú–µ–º–±—Ä–∞–Ω–∞':
                        // –û–±–≤–æ–¥–∫–∞ –≤–æ–∫—Ä—É–≥ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
                        const padding = 8;
                        ctx.strokeRect(
                            Math.min(element.startX, element.endX) - padding,
                            Math.min(element.startY, element.endY) - padding,
                            Math.abs(element.endX - element.startX) + padding * 2,
                            Math.abs(element.endY - element.startY) + padding * 2
                        );
                        break;
        
                    case '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫':
                        if (element.name === '–†–∞—Å—Å–µ–∏–≤–∞—Ç–µ–ª—å –ß–µ—Ä–Ω—ã–π') {
                            // –û–±–≤–æ–¥–∫–∞ –≤–æ–∫—Ä—É–≥ –ª–∏–Ω–∏–∏
                            const dx2 = element.endX - element.startX;
                            const dy2 = element.endY - element.startY;
                            const length2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
                            const nx2 = -dy2 / length2 * 10;
                            const ny2 = dx2 / length2 * 10;
        
                            ctx.beginPath();
                            ctx.moveTo(element.startX + nx2, element.startY + ny2);
                            ctx.lineTo(element.endX + nx2, element.endY + ny2);
                            ctx.lineTo(element.endX - nx2, element.endY - ny2);
                            ctx.lineTo(element.startX - nx2, element.startY - ny2);
                            ctx.closePath();
                            ctx.stroke();
                        } else {
                            // –û–±–≤–æ–¥–∫–∞ –≤–æ–∫—Ä—É–≥ –∫—Ä—É–≥–∞
                            ctx.beginPath();
                            ctx.arc(element.startX, element.startY, 22, 0, Math.PI * 2);
                            ctx.stroke();
                        }
                        break;
        
                    case '–ó–∞–∫–ª–∞–¥–Ω–∞—è':
                        if (element.name === '–†–æ–Ω–¥–æ') {
                            ctx.strokeRect(element.startX - 20, element.startY - 15, 40, 30);
                        } else if (element.name === '–ú–∏–Ω–∏') {
                            ctx.strokeRect(element.startX - 15, element.startY - 15, 30);
                        } else if (element.name === '–°—Ç–∞–Ω–¥–∞—Ä—Ç') {
                            ctx.strokeRect(element.startX - 20, element.startY - 20, 40, 40);
                        } else if (element.name === '–ü–æ—Ç–æ–ª–æ–∫' || element.name === '–ü–ª–∏–Ω—Ç—É—Å') {
                            // –û–±–≤–æ–¥–∫–∞ –≤–æ–∫—Ä—É–≥ –ª–∏–Ω–∏–∏
                            const dx3 = element.endX - element.startX;
                            const dy3 = element.endY - element.startY;
                            const length3 = Math.sqrt(dx3 * dx3 + dy3 * dy3);
                            const nx3 = -dy3 / length3 * 12;
                            const ny3 = dx3 / length3 * 12;
        
                            ctx.beginPath();
                            ctx.moveTo(element.startX + nx3, element.startY + ny3);
                            ctx.lineTo(element.endX + nx3, element.endY + ny3);
                            ctx.lineTo(element.endX - nx3, element.endY - ny3);
                            ctx.lineTo(element.startX - nx3, element.startY - ny3);
                            ctx.closePath();
                            ctx.stroke();
                        }
                        break;
                }
        
                ctx.setLineDash([]);
            }
        
            ctx.restore();
        }

        function drawDragHighlight(element) {
            ctx.save();
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.setLineDash([5, 5]);

            if (element.category === '–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫') {
                ctx.beginPath();
                ctx.arc(element.startX, element.startY, 20, 0, Math.PI * 2);
                ctx.stroke();
            } else if (element.category === '–ó–∞–∫–ª–∞–¥–Ω–∞—è') {
                let size = 30;
                if (element.name === '–ú–∏–Ω–∏') size = 20;
                if (element.name === '–°—Ç–∞–Ω–¥–∞—Ä—Ç') size = 30;

                ctx.strokeRect(element.startX - size, element.startY - size, size * 2, size * 2);
            }

            ctx.restore();
        }

        // ============ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI ============
        function updateElementList() {
            const list = document.getElementById('elementList');
            const currentElements = elements.filter(el =>
                el.roomId == project.currentRoom &&
                el.wallId == project.currentWall
            );
        
            if (currentElements.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;"><p>–≠–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p></div>';
                updateInfoPanel();
                return;
            }
        
            list.innerHTML = currentElements.map((el, index) => `
                <div class="element-item ${String(selectedElementId) == String(el.id) ? 'selected' : ''}"
                     data-element-id="${el.id}"
                     onclick="selectElementFromList('${el.id}')"
                     style="cursor: pointer;">
                    <div class="element-item-header">
                        <span class="element-name">${el.name}</span>
                    </div>
                    <div class="element-details">
                        ${el.quantity.toFixed(2)} ${el.unit}
                        ${el.category === '–¢–∫–∞–Ω—å' || el.category === '–ú–µ–º–±—Ä–∞–Ω–∞' ?
                          `<br>–î–ª–∏–Ω–∞: ${el.calculatedWidth.toFixed(2)}–º √ó –í—ã—Å–æ—Ç–∞: ${el.calculatedHeight.toFixed(2)}–º` : ''}
                    </div>
                    <div class="element-details">
                        –ú–∞—Ç–µ—Ä–∏–∞–ª: ${el.materialCost.toFixed(0)} ‚ÇΩ<br>
                        –†–∞–±–æ—Ç–∞: ${el.laborCost.toFixed(0)} ‚ÇΩ
                    </div>
                    <div class="element-cost">
                        ${el.totalCost.toFixed(0)} ‚ÇΩ
                    </div>
                </div>
            `).join('');
        }

        function updateTotalCost() {
            let materialCost = 0;
            let workCost = 0;

            const profileGroups = {};

            elements.forEach(element => {
                if (element.category === '–ü—Ä–æ—Ñ–∏–ª—å') {
                    if (!profileGroups[element.name]) {
                        profileGroups[element.name] = {
                            totalLength: 0,
                            price: element.price,
                            workPrice: element.workPrice,
                            unit: element.unit
                        };
                    }
                    profileGroups[element.name].totalLength += element.quantity;
                } else {
                    materialCost += element.materialCost || 0;
                    workCost += element.laborCost || 0;
                }
            });

            // –î–û–ë–ê–í–õ–ï–ù–û: –£—á–µ—Ç —Ä—É—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
            manualEstimateItems.forEach(item => {
                materialCost += item.materialCost || 0;
                workCost += item.laborCost || 0;
            });

            let profileListHtml = '';
            Object.keys(profileGroups).forEach(profileName => {
                const group = profileGroups[profileName];
                const roundedLength = Math.ceil(group.totalLength / 2) * 2;
                const profileMaterialCost = roundedLength * group.price;
                const profileWorkCost = roundedLength * group.workPrice;

                materialCost += profileMaterialCost;
                workCost += profileWorkCost;

                profileListHtml += `
                    <div class="profile-item">
                        <span>${profileName}:</span>
                        <span>${group.totalLength.toFixed(2)}–º ‚Üí ${roundedLength}–º (${profileMaterialCost.toFixed(0)}‚ÇΩ)</span>
                    </div>
                `;
            });

            if (profileListHtml) {
                document.getElementById('profileSummary').style.display = 'block';
                document.getElementById('profileList').innerHTML = profileListHtml;
            } else {
                document.getElementById('profileSummary').style.display = 'none';
            }

            document.getElementById('materialCost').textContent = materialCost.toFixed(0) + ' ‚ÇΩ';
            document.getElementById('workCost').textContent = workCost.toFixed(0) + ' ‚ÇΩ';
            document.getElementById('totalCost').textContent = (materialCost + workCost).toFixed(0) + ' ‚ÇΩ';
        }

        // ============ –õ–û–ì–ò–ö–ê –í–´–î–ï–õ–ï–ù–ò–Ø –ò –£–î–ê–õ–ï–ù–ò–Ø ============

        // –í—ã–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        function selectElementFromList(elementId) {
            selectedElementId = elementId;
            contextElementId = elementId;
            updateElementList();
            updateInfoPanel();
        
            const element = elements.find(el => String(el.id) == String(elementId));
            if (element) {
                hoveredElement = element;
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è —É–¥–∞–ª–µ–Ω–∏–µ
        // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ –±—ã—Å—Ç—Ä–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è (Shift+RMB)
        function executeDelete(elementId) {
            const indexToDelete = elements.findIndex(el => String(el.id) === String(elementId));
        
            if (indexToDelete === -1) {
                console.error('–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: executeDelete –Ω–µ —Å–º–æ–≥ –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç. ID:', elementId);
                alert('–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.');
                return;
            }
        
            // –ù–∞–¥–µ–∂–Ω–æ —É–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞
            elements.splice(indexToDelete, 1);
        
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
            if (String(selectedElementId) === String(elementId)) { selectedElementId = null; }
            if (String(contextElementId) === String(elementId)) { contextElementId = null; }
            if (hoveredElement && String(hoveredElement.id) === String(elementId)) { hoveredElement = null; }
        
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∑–∞–≤–∏—Å–∏–º—ã–µ —á–∞—Å—Ç–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–µ–∫—Ç
            updateMaxWallHeight();
            updateElementList();
            updateTotalCost();
            updateInfoPanel();
            autoSaveProject();
        
            hideContextMenu();
            showNotification('–≠–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω');
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –ø–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateInfoPanel() {
            const infoContent = document.getElementById('infoContent');
            if (!infoContent) return; 

            if (!selectedElementId) {
                infoContent.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–≤–æ–π—Å—Ç–≤</p>';
                return;
            }

            const element = elements.find(el => String(el.id) == String(selectedElementId));

            if (!element) {
                infoContent.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</p>';
                selectedElementId = null; 
                return;
            }

            infoContent.innerHTML = `
                <div style="padding: 15px;">
                    <h3 style="margin: 0 0 15px 0; color: #D67A34; font-size: 16px;">${element.name}</h3>
                    <div style="font-size: 13px;">
                        <p style="margin-bottom: 8px;"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${element.category}</p>
                        <p style="margin-bottom: 8px;"><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> ${element.quantity.toFixed(2)} ${element.unit}</p>
                        ${element.category === '–¢–∫–∞–Ω—å' || element.category === '–ú–µ–º–±—Ä–∞–Ω–∞' ? `
                            <p style="margin-bottom: 8px;">
                                <strong>–†–∞–∑–º–µ—Ä:</strong> ${element.calculatedWidth.toFixed(2)}–º √ó ${element.calculatedHeight.toFixed(2)}–º
                            </p>
                        ` : ''}
                        <p style="margin-bottom: 8px;"><strong>–¶–µ–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞:</strong> ${element.price} ‚ÇΩ/${element.unit}</p>
                        <p style="margin-bottom: 8px;"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:</strong> ${element.materialCost.toFixed(0)} ‚ÇΩ</p>
                        <p style="margin-bottom: 8px;"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç:</strong> ${element.laborCost.toFixed(0)} ‚ÇΩ</p>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 2px solid #D67A34;">
                            <strong>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> <span style="color: #D67A34; font-size: 18px; font-weight: bold;">${element.totalCost.toFixed(0)} ‚ÇΩ</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Ç–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        function clearCanvas() {
            if (!project.name) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç.');
                return;
            }
        
            if (elements.length === 0 && manualEstimateItems.length === 0) {
                showNotification('–ü—Ä–æ–µ–∫—Ç —É–∂–µ –ø—É—Å—Ç. –ù–µ—á–µ–≥–æ —É–¥–∞–ª—è—Ç—å.');
                return;
            }
        
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã –∏ —Ä—É—á–Ω—ã–µ —Å–º–µ—Ç–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.')) {
                elements.length = 0;
                manualEstimateItems.length = 0;
        
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
                currentTool = null;
                isDrawing = false;
                currentElement = null;
                document.querySelectorAll('.tool-item').forEach(item => {
                    item.classList.remove('selected');
                });
                canvas.style.cursor = 'default'; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
        
                showNotification('–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω');
                
                deselectElement();
                
                updateMaxWallHeight();
                updateElementList();
                updateTotalCost();
                updateInfoPanel();
                autoSaveProject();
            }
        }

        // ============ –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage ============
        function saveProject() {
            if (!project.name) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç');
                return;
            }

            const projectData = {
                project: project,
                elements: elements,
                manualEstimateItems: manualEstimateItems,
                savedAt: new Date().toISOString(),
                version: '1.0'
            };

            try {
                localStorage.setItem(`project_${project.name}`, JSON.stringify(projectData));

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
                let projectsList = JSON.parse(localStorage.getItem('projectsList') || '[]');
                if (!projectsList.includes(project.name)) {
                    projectsList.push(project.name);
                    localStorage.setItem('projectsList', JSON.stringify(projectsList));
                }

                alert('–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞');
            }
        }

        function autoSaveProject() {
            if (project.name) {
                try {
                    const projectData = {
                        project: project,
                        elements: elements,
                        manualEstimateItems: manualEstimateItems,
                        savedAt: new Date().toISOString(),
                        version: '1.0'
                    };
                    localStorage.setItem(`project_${project.name}`, JSON.stringify(projectData));
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                }
            }
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π —Å—Ç–∞—Ä—ã—Ö ID
        function loadProject(projectName) {
            try {
                const projectData = JSON.parse(localStorage.getItem(`project_${projectName}`));

                if (!projectData) {
                    alert('–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }

                project = projectData.project;
                elements = projectData.elements || [];
                manualEstimateItems = projectData.manualEstimateItems || [];

                let projectNeedsResave = false;
                elements.forEach(el => {
                    if (typeof el.id !== 'string' || !el.id.startsWith('element_')) {
                        el.id = `element_${Date.now()}_${elementIdCounter++}`;
                        projectNeedsResave = true;
                    }
                });

                if (projectNeedsResave) {
                    console.warn('–û–±–Ω–æ–≤–ª–µ–Ω—ã ID —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–∞—Ä–æ–º –ø—Ä–æ–µ–∫—Ç–µ. –ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω—è–µ–º...');
                    autoSaveProject();
                }

                elementIdCounter = Math.max(...elements.map(el => {
                    const parts = (el.id || 'element_0_0').split('_');
                    return parseInt(parts[2]) || 0;
                }), 0) + 1;

                document.getElementById('projectName').textContent = project.name;
                document.getElementById('noProject').style.display = 'none';
                document.getElementById('canvasWrapper').style.display = 'block';
                document.getElementById('roomSelector').style.display = 'block';

                updateRoomSelector();
                updateElementList();
                updateTotalCost();

                alert('–ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞');
            }
        }

        function deleteProject(projectName) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç "${projectName}"?`)) {
                try {
                    localStorage.removeItem(`project_${projectName}`);

                    let projectsList = JSON.parse(localStorage.getItem('projectsList') || '[]');
                    projectsList = projectsList.filter(name => name !== projectName);
                    localStorage.setItem('projectsList', JSON.stringify(projectsList));

                    loadProjectsList();
                    alert('–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª–µ–Ω!');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞');
                }
            }
        }

        // ============ –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ ============
        function showProjectManager() {
            document.getElementById('projectManagerModal').classList.add('active');
            loadProjectsList();
        }

        function closeProjectManager() {
            document.getElementById('projectManagerModal').classList.remove('active');
        }

        function loadProjectsList() {
            const projectsList = JSON.parse(localStorage.getItem('projectsList') || '[]');
            const container = document.getElementById('projectsList');

            if (projectsList.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;"><p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</p></div>';
                return;
            }

            let html = '';
            projectsList.forEach(projectName => {
                const projectData = JSON.parse(localStorage.getItem(`project_${projectName}`) || '{}');
                const savedAt = projectData.savedAt ? new Date(projectData.savedAt).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

                html += `
                    <div class="project-item">
                        <div class="project-info-item">
                            <div class="project-name">${projectName}</div>
                            <div class="project-details">
                                –ê–¥—Ä–µ—Å: ${projectData.project?.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                                –°–æ—Ö—Ä–∞–Ω–µ–Ω: ${savedAt}
                            </div>
                        </div>
                        <div class="project-actions">
                            <button class="btn-load" onclick="loadProject('${projectName}'); closeProjectManager();">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            <button class="btn-small btn-delete" onclick="deleteProject('${projectName}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ============ –†–µ–¥–∞–∫—Ç–æ—Ä —Å–º–µ—Ç—ã ============
        function showEstimateEditor() {
            if (!project.name) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç');
                return;
            }

            document.getElementById('estimateModal').classList.add('active');
            loadEstimateData();
        }

        function closeEstimateEditor() {
            document.getElementById('estimateModal').classList.remove('active');
        }

        function loadEstimateData() {
                    const tbody = document.getElementById('estimateTableBody');
                    let html = '';
                    let index = 1;
        
                    const profileGroups = {};
                    const fabricGroups = {}; // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–∫–∞–Ω–∏
                    const otherElements = [];
        
                    elements.forEach(element => {
                        if (element.category === '–ü—Ä–æ—Ñ–∏–ª—å') {
                            const key = element.name;
                            if (!profileGroups[key]) {
                                profileGroups[key] = {
                                    name: element.name,
                                    totalLength: 0,
                                    price: element.price,
                                    workPrice: element.workPrice,
                                    unit: element.unit,
                                    category: '–ü—Ä–æ—Ñ–∏–ª—å'
                                };
                            }
                            profileGroups[key].totalLength += element.quantity;
                        } else if (element.category === '–¢–∫–∞–Ω—å') {
                            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç–∫–∞–Ω—å, –∏—Å–∫–ª—é—á–∞—è "–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ"
                            if (element.name !== '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ') {
                                const key = element.name;
                                if (!fabricGroups[key]) {
                                    fabricGroups[key] = {
                                        name: element.name,
                                        totalArea: 0,
                                        price: element.price,
                                        workPrice: element.workPrice,
                                        unit: element.unit,
                                        category: '–¢–∫–∞–Ω—å'
                                    };
                                }
                                fabricGroups[key].totalArea += element.quantity;
                            }
                        } else {
                            otherElements.push(element);
                        }
                    });
        
                    Object.values(profileGroups).forEach(profile => {
                        const roundedLength = Math.ceil(profile.totalLength / 2) * 2;
                        const materialCost = roundedLength * profile.price;
                        const laborCost = roundedLength * profile.workPrice;
                        const totalCost = materialCost + laborCost;
        
                        html += `
                            <tr data-id="profile-${profile.name}">
                                <td>${index++}</td>
                                <td><input type="text" value="${profile.name}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="number" step="0.01" value="${roundedLength.toFixed(2)}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="text" value="${profile.unit}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="number" value="${profile.price}" onchange="updateEstimateRow(this)"></td>
                                <td>${materialCost.toFixed(0)}</td>
                                <td>${laborCost.toFixed(0)}</td>
                                <td>${totalCost.toFixed(0)}</td>
                            </tr>
                        `;
                    });
        
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∫–∞–Ω–∏ —Å —É—á–µ—Ç–æ–º "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ"
                    const excessRemovalArea = getExcessRemovalArea(); // –ü–æ–ª—É—á–∞–µ–º –æ–±—â—É—é –ø–ª–æ—â–∞–¥—å "–£–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ"
                    Object.values(fabricGroups).forEach(fabric => {
                        const netArea = Math.max(0, fabric.totalArea - excessRemovalArea); // –ß–∏—Å—Ç–∞—è –ø–ª–æ—â–∞–¥—å
                        const materialCost = fabric.totalArea * fabric.price; // –°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –Ω–∞ –≤—Å—é –ø–ª–æ—â–∞–¥—å
                        const laborCost = netArea * fabric.workPrice; // –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç –Ω–∞ —á–∏—Å—Ç—É—é –ø–ª–æ—â–∞–¥—å
                        const totalCost = materialCost + laborCost;
        
                        html += `
                            <tr data-id="fabric-${fabric.name}">
                                <td>${index++}</td>
                                <td><input type="text" value="${fabric.name}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="number" step="0.01" value="${fabric.totalArea.toFixed(2)}" onchange="updateEstimateRow(this)" readonly></td>
                                <td><input type="text" value="${fabric.unit}" onchange="updateEstimateRow(this)" readonly></td>
                                <td><input type="number" value="${fabric.price}" onchange="updateEstimateRow(this)" readonly></td>
                                <td>${materialCost.toFixed(0)}</td>
                                <td>${laborCost.toFixed(0)}</td>
                                <td>${totalCost.toFixed(0)}</td>
                            </tr>
                        `;
                    });
        
                    // –î–æ–±–∞–≤–ª—è–µ–º "–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ" –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É
                    const excessRemovalElements = elements.filter(el => el.category === '–¢–∫–∞–Ω—å' && el.name === '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ');
                    if (excessRemovalElements.length > 0) {
                        let totalExcessRemovalArea = 0;
                        let totalExcessRemovalCost = 0;
                        let totalExcessRemovalWorkCost = 0;
                        let totalExcessRemovalMaterialCost = 0;
                        let price = 0;
                        let workPrice = 0;
        
                        excessRemovalElements.forEach(el => {
                            totalExcessRemovalArea += el.quantity;
                            price = el.price;
                            workPrice = el.workPrice;
                            totalExcessRemovalMaterialCost += el.materialCost;
                            totalExcessRemovalWorkCost += el.laborCost;
                            totalExcessRemovalCost += el.totalCost;
                        });
        
                        html += `
                            <tr data-id="fabric-–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ">
                                <td>${index++}</td>
                                <td><input type="text" value="–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ" onchange="updateEstimateRow(this)" readonly></td>
                                <td><input type="number" step="0.01" value="${totalExcessRemovalArea.toFixed(2)}" onchange="updateEstimateRow(this)" readonly></td>
                                <td><input type="text" value="–º¬≤" onchange="updateEstimateRow(this)" readonly></td>
                                <td><input type="number" value="${price}" onchange="updateEstimateRow(this)" readonly></td>
                                <td>${totalExcessRemovalMaterialCost.toFixed(0)}</td>
                                <td>${totalExcessRemovalWorkCost.toFixed(0)}</td>
                                <td>${totalExcessRemovalCost.toFixed(0)}</td>
                            </tr>
                        `;
                    }
        
                    otherElements.forEach(el => {
                        html += `
                            <tr data-id="${el.id}">
                                <td>${index++}</td>
                                <td><input type="text" value="${el.name}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="number" step="0.01" value="${el.quantity.toFixed(2)}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="text" value="${el.unit}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="number" value="${el.price}" onchange="updateEstimateRow(this)"></td>
                                <td>${el.materialCost.toFixed(0)}</td>
                                <td>${el.laborCost.toFixed(0)}</td>
                                <td>${el.totalCost.toFixed(0)}</td>
                            </tr>
                        `;
                    });
        
                    manualEstimateItems.forEach((item, idx) => {
                        html += `
                            <tr data-manual-id="${idx}" style="background: #fff9c4;">
                                <td>${index++}</td>
                                <td><input type="text" value="${item.name}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="number" step="0.01" value="${item.quantity}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="text" value="${item.unit}" onchange="updateEstimateRow(this)"></td>
                                <td><input type="number" value="${item.price}" onchange="updateEstimateRow(this)"></td>
                                <td>${item.materialCost.toFixed(0)}</td>
                                <td>${item.laborCost.toFixed(0)}</td>
                                <td>${item.totalCost.toFixed(0)}</td>
                            </tr>
                        `;
                    });
        
                    tbody.innerHTML = html;
                    updateEstimateTotals();
                }

        function addManualRow() {
            manualEstimateItems.push({
                name: '–ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è',
                quantity: 1,
                unit: '—à—Ç',
                price: 0,
                workPrice: 0,
                materialCost: 0,
                laborCost: 0,
                totalCost: 0
            });
            loadEstimateData();
        }

        function updateEstimateRow(input) {
            const row = input.closest('tr');
            const cells = row.querySelectorAll('input');

            const name = cells[0].value;
            const quantity = parseFloat(cells[1].value) || 0;
            const unit = cells[2].value;
            const price = parseFloat(cells[3].value) || 0;

            const materialCost = quantity * price;
            const laborCost = 0; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ä—É—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
            const totalCost = materialCost + laborCost;

            row.cells[5].textContent = materialCost.toFixed(0);
            row.cells[6].textContent = laborCost.toFixed(0);
            row.cells[7].textContent = totalCost.toFixed(0);

            const manualId = row.dataset.manualId;
            if (manualId !== undefined) {
                const item = manualEstimateItems[parseInt(manualId)];
                if (item) {
                    item.name = name;
                    item.quantity = quantity;
                    item.unit = unit;
                    item.price = price;
                    item.materialCost = materialCost;
                    item.laborCost = laborCost;
                    item.totalCost = totalCost;
                }
            }

            updateEstimateTotals();
        }

        function updateEstimateTotals() {
            let totalMaterial = 0;
            let totalWork = 0;

            const rows = document.querySelectorAll('#estimateTableBody tr');
            rows.forEach(row => {
                const material = parseFloat(row.cells[5].textContent) || 0;
                const work = parseFloat(row.cells[6].textContent) || 0;
                totalMaterial += material;
                totalWork += work;
            });

            document.getElementById('estimateTotalMaterial').textContent = totalMaterial.toFixed(0) + ' ‚ÇΩ';
            document.getElementById('estimateTotalWork').textContent = totalWork.toFixed(0) + ' ‚ÇΩ';
            document.getElementById('estimateGrandTotal').textContent = (totalMaterial + totalWork).toFixed(0) + ' ‚ÇΩ';
        }

        function saveEstimateChanges() {
            const rows = document.querySelectorAll('#estimateTableBody tr[data-manual-id]');

            rows.forEach((row) => {
                const manualId = parseInt(row.dataset.manualId);
                const cells = row.querySelectorAll('input');

                if (manualEstimateItems[manualId]) {
                    manualEstimateItems[manualId].name = cells[0].value;
                    manualEstimateItems[manualId].quantity = parseFloat(cells[1].value) || 0;
                    manualEstimateItems[manualId].unit = cells[2].value;
                    manualEstimateItems[manualId].price = parseFloat(cells[3].value) || 0;

                    const quantity = manualEstimateItems[manualId].quantity;
                    const price = manualEstimateItems[manualId].price;

                    manualEstimateItems[manualId].materialCost = quantity * price;
                    manualEstimateItems[manualId].laborCost = 0;
                    manualEstimateItems[manualId].totalCost = manualEstimateItems[manualId].materialCost + manualEstimateItems[manualId].laborCost;
                }
            });

            updateTotalCost();
            autoSaveProject();
            closeEstimateEditor();
            alert('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        // ============ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤ Excel ============
        function downloadExcel() {
            if (!project.name) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç');
                return;
            }

            const data = [];

            data.push(['–°–ú–ï–¢–ê –ù–ê –û–¢–î–ï–õ–ö–£ –°–¢–ï–ù']);
            data.push([]);
            data.push(['–ü—Ä–æ–µ–∫—Ç:', project.name]);
            data.push(['–ê–¥—Ä–µ—Å:', project.address]);
            data.push(['–ó–∞–∫–∞–∑—á–∏–∫:', project.clientName]);
            data.push(['–¢–µ–ª–µ—Ñ–æ–Ω:', project.clientPhone]);
            data.push(['–î–∞—Ç–∞:', new Date().toLocaleDateString('ru-RU')]);
            data.push([]);

            data.push(['‚Ññ', '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', '–ï–¥.', '–¶–µ–Ω–∞', '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã', '–†–∞–±–æ—Ç–∞', '–ò—Ç–æ–≥–æ']);

            let index = 1;
            let totalMaterial = 0;
            let totalWork = 0;

            const profileGroups = {};
            const otherElements = [];

            elements.forEach(element => {
                if (element.category === '–ü—Ä–æ—Ñ–∏–ª—å') {
                    const key = element.name;
                    if (!profileGroups[key]) {
                        profileGroups[key] = {
                            name: element.name,
                            totalLength: 0,
                            price: element.price,
                            workPrice: element.workPrice,
                            unit: element.unit
                        };
                    }
                    profileGroups[key].totalLength += element.quantity;
                } else {
                    otherElements.push(element);
                }
            });

            Object.values(profileGroups).forEach(profile => {
                const roundedLength = Math.ceil(profile.totalLength / 2) * 2;
                const materialCost = roundedLength * profile.price;
                const laborCost = roundedLength * profile.workPrice;
                const total = materialCost + laborCost;

                data.push([
                    index++,
                    profile.name,
                    roundedLength.toFixed(2),
                    profile.unit,
                    profile.price,
                    materialCost.toFixed(0),
                    laborCost.toFixed(0),
                    total.toFixed(0)
                ]);

                totalMaterial += materialCost;
                totalWork += laborCost;
            });

            otherElements.forEach(el => {
                data.push([
                    index++,
                    el.name,
                    el.quantity.toFixed(2),
                    el.unit,
                    el.price,
                    el.materialCost.toFixed(0),
                    el.laborCost.toFixed(0),
                    el.totalCost.toFixed(0)
                ]);

                totalMaterial += el.materialCost;
                totalWork += el.laborCost;
            });

            manualEstimateItems.forEach(item => {
                data.push([
                    index++,
                    item.name,
                    item.quantity,
                    item.unit,
                    item.price,
                    item.materialCost.toFixed(0),
                    item.laborCost.toFixed(0),
                    item.totalCost.toFixed(0)
                ]);

                totalMaterial += item.materialCost;
                totalWork += item.laborCost;
            });

            data.push([]);
            data.push(['', '', '', '', '–ò–¢–û–ì–û:', totalMaterial.toFixed(0), totalWork.toFixed(0), (totalMaterial + totalWork).toFixed(0)]);

            const ws = XLSX.utils.aoa_to_sheet(data);

            ws['!cols'] = [
                {wch: 5},
                {wch: 30},
                {wch: 12},
                {wch: 8},
                {wch: 10},
                {wch: 12},
                {wch: 12},
                {wch: 12}
            ];

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '–°–º–µ—Ç–∞');

            XLSX.writeFile(wb, `–°–º–µ—Ç–∞_${project.name}_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // ============ –ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ ============
        function showProjectWizard() {
            document.getElementById('projectWizard').classList.add('active');
            currentWizardStep = 1;
            updateWizardStep();
        }

        function closeProjectWizard() {
            document.getElementById('projectWizard').classList.remove('active');
        }

        function updateWizardStep() {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`wizardStep${i}`);
                step.classList.remove('active', 'completed');
                if (i < currentWizardStep) {
                    step.classList.add('completed');
                } else if (i === currentWizardStep) {
                    step.classList.add('active');
                }
            }

            const content = document.getElementById('wizardContent');

            switch(currentWizardStep) {
                case 1:
                    content.innerHTML = `
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *</label>
                            <input type="text" id="projectNameInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ –¢–≤–µ—Ä—Å–∫–æ–π" value="${project.name || ''}">
                        </div>
                        <div class="form-group">
                            <label>–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞ *</label>
                            <input type="text" id="addressInput" placeholder="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 1" value="${project.address || ''}">
                        </div>
                        <div class="form-group">
                            <label>–§–ò–û –∑–∞–∫–∞–∑—á–∏–∫–∞ *</label>
                            <input type="text" id="clientNameInput" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" value="${project.clientName || ''}">
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫–∞–∑—á–∏–∫–∞ *</label>
                            <input type="tel" id="clientPhoneInput" placeholder="+7 (999) 123-45-67" value="${project.clientPhone || ''}">
                        </div>
                    `;
                    document.getElementById('prevBtn').style.display = 'none';
                    break;

                case 2:
                    content.innerHTML = `
                        <h3 style="margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞</h3>
                        <div class="object-types">
                            <div class="object-type-card ${project.objectType === 'apartment' ? 'selected' : ''}" onclick="selectObjectType('apartment')">
                                <div class="type-icon">üè¢</div>
                                <div class="type-name">–ö–≤–∞—Ä—Ç–∏—Ä–∞</div>
                            </div>
                            <div class="object-type-card ${project.objectType === 'house' ? 'selected' : ''}" onclick="selectObjectType('house')">
                                <div class="type-icon">üè†</div>
                                <div class="type-name">–î–æ–º</div>
                            </div>
                            <div class="object-type-card ${project.objectType === 'commercial' ? 'selected' : ''}" onclick="selectObjectType('commercial')">
                                <div class="type-icon">üè≠</div>
                                <div class="type-name">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π</div>
                            </div>
                        </div>
                    `;
                    document.getElementById('prevBtn').style.display = 'inline-block';
                    break;

                case 3:
                    content.innerHTML = `
                        <h3 style="margin-bottom: 20px; text-align: center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</h3>
                        <div class="counter">
                            <button class="counter-btn" onclick="changeRoomCount(-1)">‚àí</button>
                            <div class="counter-value" id="roomCountDisplay">${project.roomCount}</div>
                            <button class="counter-btn" onclick="changeRoomCount(1)">+</button>
                        </div>
                        <p style="text-align: center; color: #666; margin-top: 10px;">–û—Ç 1 –¥–æ 15 –∫–æ–º–Ω–∞—Ç</p>
                    `;
                    break;

                case 4:
                    let roomConfigHtml = '<h3 style="margin-bottom: 15px;">–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–µ–Ω –≤ –∫–∞–∂–¥–æ–π –∫–æ–º–Ω–∞—Ç–µ</h3><div class="room-config">';
                    for (let i = 0; i < project.roomCount; i++) {
                        const wallCount = project.rooms[i]?.wallCount || 4;
                        roomConfigHtml += `
                            <div class="room-config-item">
                                <strong>–ö–æ–º–Ω–∞—Ç–∞ ${i + 1}</strong>
                                <select id="room${i}walls" onchange="updateRoomWalls(${i}, this.value)">
                                    ${[1,2,3,4,5,6,7,8].map(n =>
                                        `<option value="${n}" ${wallCount === n ? 'selected' : ''}>${n} —Å—Ç–µ–Ω</option>`
                                    ).join('')}
                                </select>
                            </div>
                        `;
                    }
                    roomConfigHtml += '</div>';
                    content.innerHTML = roomConfigHtml;

                    document.getElementById('nextBtn').textContent = '‚úì –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç';
                    break;
            }
        }

        function selectObjectType(type) {
            project.objectType = type;
            document.querySelectorAll('.object-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.object-type-card').classList.add('selected');
        }

        function changeRoomCount(delta) {
            project.roomCount = Math.max(1, Math.min(15, project.roomCount + delta));
            document.getElementById('roomCountDisplay').textContent = project.roomCount;
        }

        function updateRoomWalls(roomIndex, wallCount) {
            if (!project.rooms[roomIndex]) {
                project.rooms[roomIndex] = {};
            }
            project.rooms[roomIndex].wallCount = parseInt(wallCount);
        }

        function nextWizardStep() {
            if (currentWizardStep === 1) {
                project.name = document.getElementById('projectNameInput').value;
                project.address = document.getElementById('addressInput').value;
                project.clientName = document.getElementById('clientNameInput').value;
                project.clientPhone = document.getElementById('clientPhoneInput').value;

                if (!project.name || !project.address || !project.clientName || !project.clientPhone) {
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                    return;
                }
            }

            if (currentWizardStep === 2 && !project.objectType) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞');
                return;
            }

            if (currentWizardStep === 4) {
                createProjectFromWizard();
                return;
            }

            currentWizardStep++;
            updateWizardStep();
        }

        function prevWizardStep() {
            if (currentWizardStep > 1) {
                currentWizardStep--;
                updateWizardStep();
            }
        }

        function createProjectFromWizard() {
            project.rooms = [];
            for (let i = 0; i < project.roomCount; i++) {
                const wallCount = parseInt(document.getElementById(`room${i}walls`).value);
                project.rooms.push({
                    name: `–ö–æ–º–Ω–∞—Ç–∞ ${i + 1}`,
                    wallCount: wallCount,
                    walls: Array.from({length: wallCount}, (_, j) => ({
                        name: `–°—Ç–µ–Ω–∞ ${j + 1}`,
                        elements: []
                    }))
                });
            }

            project.currentRoom = 0;
            project.currentWall = 0;

            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
            elements.length = 0;
            manualEstimateItems.length = 0;

            document.getElementById('projectName').textContent = project.name;
            document.getElementById('noProject').style.display = 'none';
            document.getElementById('canvasWrapper').style.display = 'block';
            document.getElementById('roomSelector').style.display = 'block';

            updateRoomSelector();
            updateElementList();
            updateTotalCost();
            autoSaveProject(); // –î–û–ë–ê–í–õ–ï–ù–û: –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            closeProjectWizard();

            alert('–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω! –ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–±–æ—Ç—É.');
        }

        function updateRoomSelector() {
            const select = document.getElementById('roomSelect');
            select.innerHTML = project.rooms.map((room, i) =>
                `<option value="${i}" ${i == project.currentRoom ? 'selected' : ''}>${room.name}</option>`
            ).join('');

            updateWallTabs();
        }

        function updateWallTabs() {
            const tabs = document.getElementById('wallTabs');
            const currentRoom = project.rooms[project.currentRoom];

            if (!currentRoom) return;

            tabs.innerHTML = currentRoom.walls.map((wall, i) =>
                `<div class="wall-tab ${i == project.currentWall ? 'active' : ''}" onclick="changeWall(${i})">
                    –°—Ç–µ–Ω–∞ ${i + 1}
                </div>`
            ).join('');
        }

        function changeRoom() {
            project.currentRoom = parseInt(document.getElementById('roomSelect').value);
            project.currentWall = 0;
            updateWallTabs();
            updateMaxWallHeight();
            updateElementList();
            updateTotalCost();
        }

        function changeWall(wallIndex) {
            project.currentWall = wallIndex;
            updateWallTabs();
            updateMaxWallHeight();
            updateElementList();
            updateTotalCost();
        }

        // ============ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å ============
        function showAdminPanel() {
            document.getElementById('adminModal').classList.add('active');

            if (!isAdminAuthenticated) {
                document.getElementById('adminAuth').style.display = 'block';
                document.getElementById('adminContent').style.display = 'none';
            } else {
                document.getElementById('adminAuth').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadAdminTools();
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminModal').classList.remove('active');
        }

        function adminLogin() {
            const login = document.getElementById('adminLogin').value;
            const password = document.getElementById('adminPassword').value;

            if (login === 'bidoncloseup' && password === 'TimkaMimka12345') {
                isAdminAuthenticated = true;
                document.getElementById('adminAuth').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadAdminTools();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
            }
        }

        function showAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'tools') {
                document.getElementById('adminToolsTab').style.display = 'block';
                document.getElementById('adminLogoTab').style.display = 'none';
                loadAdminTools();
            } else if (tab === 'logo') {
                document.getElementById('adminToolsTab').style.display = 'none';
                document.getElementById('adminLogoTab').style.display = 'block';
                document.getElementById('currentLogo').src = document.getElementById('companyLogo').src;
            }
        }

        function loadAdminTools() {
            const tbody = document.getElementById('toolsTableBody');
            tbody.innerHTML = toolsDatabase.map(tool => `
                <tr>
                    <td>${tool.category}</td>
                    <td><input type="text" value="${tool.name}" id="name${tool.id}"></td>
                    <td><input type="text" value="${tool.unit}" id="unit${tool.id}" style="width: 60px;"></td>
                    <td><input type="number" value="${tool.price}" id="price${tool.id}" style="width: 80px;"></td>
                    <td><input type="number" value="${tool.workPrice}" id="work${tool.id}" style="width: 80px;"></td>
                    <td><input type="number" step="0.01" value="${tool.height}" id="height${tool.id}" style="width: 80px;"></td>
                    <td>
                        <button class="btn-small btn-save" onclick="updateTool(${tool.id})">üíæ</button>
                        <button class="btn-small btn-delete" onclick="deleteTool(${tool.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function addNewTool() {
            const newTool = {
                id: Date.now(),
                category: document.getElementById('newToolCategory').value,
                name: document.getElementById('newToolName').value,
                unit: document.getElementById('newToolUnit').value,
                price: parseFloat(document.getElementById('newToolPrice').value) || 0,
                workPrice: parseFloat(document.getElementById('newToolWorkPrice').value) || 0,
                height: parseFloat(document.getElementById('newToolHeight').value) || 0
            };

            if (!newTool.name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞');
                return;
            }

            toolsDatabase.push(newTool);
            loadTools();
            loadAdminTools();

            document.getElementById('newToolName').value = '';
            document.getElementById('newToolUnit').value = '';
            document.getElementById('newToolPrice').value = '';
            document.getElementById('newToolWorkPrice').value = '';
            document.getElementById('newToolHeight').value = '';

            alert('–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
        }

        function updateTool(id) {
            const tool = toolsDatabase.find(t => t.id == id);
            if (tool) {
                tool.name = document.getElementById(`name${id}`).value;
                tool.unit = document.getElementById(`unit${id}`).value;
                tool.price = parseFloat(document.getElementById(`price${id}`).value) || 0;
                tool.workPrice = parseFloat(document.getElementById(`work${id}`).value) || 0;
                tool.height = parseFloat(document.getElementById(`height${id}`).value) || 0;

                loadTools();
                alert('–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω');
            }
        }

        function deleteTool(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?')) {
                toolsDatabase = toolsDatabase.filter(t => t.id != id);
                loadTools();
                loadAdminTools();
            }
        }

        function updateLogo() {
            const logoUrl = document.getElementById('logoUrl').value;
            if (logoUrl) {
                document.getElementById('companyLogo').src = logoUrl;
                localStorage.setItem('companyLogo', logoUrl);
                alert('–õ–æ–≥–æ—Ç–∏–ø –æ–±–Ω–æ–≤–ª–µ–Ω');
            }
        }

        function loadLogoFromStorage() {
            const savedLogo = localStorage.getItem('companyLogo');
            if (savedLogo) {
                document.getElementById('companyLogo').src = savedLogo;
            }
        }
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>